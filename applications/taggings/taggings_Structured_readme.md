# taggings_agent_Structured_readme.md

## 📋 结构化文档骨架

### A1: 开发边界与职责说明

```
├── A1-1: 模块基本定义
│   └── taggings_agent是Career Bot系统的AI标签生成与语义管理中心，负责将非结构化的用户、公司、职位信息转化为高质量、结构化的七层标签体系(Layer 0-6)，为智能匹配引擎提供精准的语义数据基础。该模块通过通过llm_handler_agent进行LLM调用、向量化处理和语义检索，构建完整的实体标签画像。
├── A1-2: 核心价值特性
│   ├── A1-2.1: 语义理解引擎 - 作为系统的语义理解和知识提取引擎，能从原始数据中提取显性标签和隐含特质
│   ├── A1-2.2: 七层标签体系 - 通过Layer 0背景层、Layer 1职位层、Layer 2技能层、Layer 3地理层、Layer 4积极特质层、Layer 5消极特质层、Layer 6风险层实现全方位语义建模
│   ├── A1-2.3: 智能匹配支持 - 支持精准匹配和智能推荐，为matching_agent提供预生成标签向量
│   └── A1-2.4: 三实体处理能力 - 支持用户、企业、职位三种实体类型的完整标签生成
├── A1-3: 职责边界限制
│   ├── A1-3.1: 专注标签生成 - 专注于标签生成、语义向量化、数据预格式化，不涉及匹配算法或推荐逻辑
│   ├── A1-3.2: 数据格式化责任 - 负责将生成的标签数据格式化为database_agent所需的存储格式
│   ├── A1-3.3: 业务协作边界 - 与llm_handler_agent协作进行智能内容分析，与resume_agent等业务模块协作获取原始数据
│   └── A1-3.4: 被动调用特性 - 不包含启动逻辑和测试代码，系统启动统一在boot/目录，通过routing_agent进行统一调度
```

------------------------------

### A2: 系统架构与模块定义

```
├── A2-1: 模块依赖关系
│   ├── A2-1.1: 上游触发模块
│   │   ├── routing_agent - 任务调度和配置管理，协调所有打标请求
│   │   ├── resume_agent - 求职者5步骤完成后触发一次性打标
│   │   ├── company_identity_agent - 企业文件上传完成后触发公司基础打标
│   │   ├── jobpost_agent - 每次招聘简章上传时触发该简章的专项打标
│   │   └── database_agent - 用户信息更新时触发重新打标，维护标签一致性
│   ├── A2-1.2: 下游调用模块
│   │   ├── llm_handler_agent - 执行七层标签体系AI生成，支持6轮独立LLM调用
│   │   ├── database_agent - 标签向量化后的存储和嵌套结构组织
│   │   └── matching_agent - 提供预生成标签向量用于cosine_similarity匹配
│   └── A2-1.3: 数据约束关系
│       ├── 七层标签体系标准化输出 - 每层独立生成和向量化
│       ├── 嵌套存储结构 - 用户ID → {个人画像集合, 公司1{招聘1,招聘2,招聘3}, 公司2{招聘1,招聘2}}
│       ├── 向量维度一致性 - 所有标签向量必须使用统一的embedding模型和维度
│       └── 语义去重机制 - 每层生成前查询ChromaDB避免重复标签
├── A2-2: 并发与顺序性控制
│   ├── A2-2.1: 求职者打标策略 - 5步骤完成后一次性处理，避免部分信息打标
│   ├── A2-2.2: 企业分层打标 - 公司基础信息优先，招聘简章依次处理
│   ├── A2-2.3: 并发限制机制 - 单用户同时最多3个打标任务，防止资源竞争
│   └── A2-2.4: 批量更新处理 - 企业多职位批量打标时使用异步并发处理
└── A2-3: 系统架构位置
    └── 数据来源 → routing_agent → [taggings_agent] → 标签生成与向量化 → llm_handler_agent(多轮AI分析) → database_agent(向量存储)
```

------------------------------

### A3: 输入输出规范、配置机制、模型路径、调用方式

```
├── A3-1: 输入数据规范
│   ├── A3-1.1: 完整AgentRequest输入结构
│   │   ├── request_id - 请求唯一标识
│   │   ├── task_type - 主要任务类型generate_multilayer_tags
│   │   ├── context.data.operation - 具体操作类型generate_multilayer_tags
│   │   ├── context.data.entity_type - 实体类型(user/company/jobpost)
│   │   ├── context.data.entity_id - 实体唯一标识
│   │   ├── context.data.source_data - 原始数据源(个人信息/工作经验/教育背景等)
│   │   ├── context.data.target_layers - 目标生成层级[0,1,2,3,4,5,6]
│   │   └── context.data.generation_options - 生成选项配置
│   ├── A3-1.2: 三实体数据源规范
│   │   ├── 用户数据源 - resume_agent26字段个人档案+MBTI+两次分析报告
│   │   ├── 企业数据源 - 企业注册文档验证结果(SEC、GIS、Business Permit、BIR等)
│   │   └── 职位数据源 - jobpost职位描述文档和详细要求
│   └── A3-1.3: 输入数据验证规则
│       ├── 所有外部输入必须显式校验长度/类型/枚举/格式
│       ├── entity_type枚举值验证(user/company/jobpost)
│       └── target_layers数组范围验证(0-6)
├── A3-2: 输出数据规范
│   ├── A3-2.1: 标准AgentResponse格式
│   │   ├── request_id - 对应请求ID
│   │   ├── agent_name - "taggings_agent"
│   │   ├── success - 标签生成成功状态
│   │   ├── timestamp - 响应时间戳
│   │   ├── response - 标签生成结果数据
│   │   └── error - 错误信息(成功时为null)
│   ├── A3-2.2: 预格式化输出结构
│   │   ├── master_tag_updates - 中央标签库更新数据
│   │   ├── entity_tag_references - 实体标签引用关系
│   │   ├── brainstorm_summary - 头脑风暴分析总结
│   │   └── metadata - 处理元数据信息
│   └── A3-2.3: 输出数据校验规则
│       ├── tag_id格式L[0-6]_[TYPE]_[SEQ]校验
│       ├── embedding_vector为1536维浮点数数组
│       ├── confidence_score范围0.0-1.0验证
│       └── applied_at使用ISO8601格式
├── A3-3: 配置机制规范
│   ├── A3-3.1: 统一配置获取方式
│   │   └── 通过routing_agent.get_config("taggings_agent", config_type)获取所有配置参数、提示词模板等，已迁移至global_config.json
│   ├── A3-3.2: 配置类型分类 (已迁移至global_config.json)
│   │   ├── layer_config - 七层标签系统的完整配置和规则定义，包含layer_definitions和weight_system
│   │   ├── vector_config - embedding模型、相似度阈值、去重策略配置，已完整迁移
│   │   ├── llm_prompts - 完整的AI提示词模板库，包含头脑风暴分析和各层级标签生成提示词
│   │   └── similarity_thresholds - 语义相似度阈值配置，已整合至global_config中
│   ├── A3-3.3: 热更新与回滚策略
│   │   ├── 配置键名/层级不可私改
│   │   ├── 新增键必须提供默认值、回滚策略
│   │   └── 未在global_config注册的键不得使用
│   └── A3-3.4: ⚠️ 待补配置项
│       ├── quality_config.minimum_tag_quality_score - 标签质量阈值(保守选项: 0.8/0.7/0.6)
│       └── llm_config.request_timeout_seconds - LLM调用超时时间(保守选项: 30秒/60秒/120秒)
├── A3-4: 模型路径与版本控制
│   ├── A3-4.1: LLM模型规范
│   │   ├── 统一指定模型版本 - gpt-4o-2024-08-06用于所有标签生成和embedding向量化
│   │   ├── 温度参数控制 - 使用配置动态获取temperature值，确保创造性标签生成
│   │   └── 模型调用限制 - 强制使用gpt-4o-2024-08-06，严禁直接访问OpenAI、Claude、Gemini等API
│   ├── A3-4.2: 数据模型来源控制 (已完成迁移)
│   │   ├── 统一模型引入 - 所有数据模型/Schema已迁移至global_schemas.json，由routing_agent动态分发
│   │   ├── 禁止本地定义 - 已移除所有本地模型定义，改为引用global_schemas中的模型
│   │   └── 版本兼容策略 - 所有字段变更已标注语义、默认值、兼容策略
│   └── A3-4.3: 模型定义迁移完成
│       ├── MasterTag模型 - 主标签库模型已迁移至global_schemas.json
│       ├── AppliedTag模型 - 应用标签模型已迁移至global_schemas.json
│       ├── EntityTagProfile模型 - 实体标签画像模型已迁移至global_schemas.json
│       ├── TagLayer模型 - 标签层级定义模型已迁移至global_schemas.json
│       ├── TagGenerationRequest模型 - 标签生成请求模型已迁移至global_schemas.json
│       └── TagGenerationResult模型 - 标签生成结果模型已迁移至global_schemas.json
└── A3-5: 调用方式规范
    ├── A3-5.1: 统一入口调用
    │   └── async def run(request: AgentRequest) -> AgentResponse 统一入口方法
    ├── A3-5.2: 支持任务类型
    │   ├── generate_user_tags - 生成用户七层标签体系
    │   ├── generate_company_tags - 生成企业七层标签体系
    │   ├── generate_jobpost_tags - 生成职位七层标签体系
    │   ├── vectorize_tags - 将标签转换为向量表示
    │   ├── semantic_similarity - 计算标签语义相似度
    │   └── health_check - 模块健康状态检查
    └── A3-5.3: LLM集成调用规范
        ├── 通过routing_agent调用llm_handler_agent进行LLM调用
        ├── 进行6轮独立标签生成(Layer 0,1,2,4,5,6)
        ├── 每层标签使用专用prompt模板，支持单层专精分析
        └── 语义去重：每轮生成前查询ChromaDB获取100个最相似已有标签
```

------------------------------

### A4: 用户流程、对话流程、意图识别机制

```
├── A4-1: 用户标签生成流程
│   ├── A4-1.1: 触发条件与时机
│   │   ├── 求职者一次性打标 - 完成5步骤(MBTI+反向测试+出生日期+简历+补充信息)后统一触发
│   │   ├── 信息更新重打标 - 用户修改关键信息时自动触发重新打标，确保标签与数据一致性
│   │   └── 避免部分信息打标 - 避免不完整信息影响标签质量
│   ├── A4-1.2: 数据收集与整合流程
│   │   ├── 用户完整画像整合 - resume_agent26字段、mbti_followup_agent、ninetest_agent、final_analysis_output_agent的综合数据
│   │   ├── 数据标准化处理 - 确保输入数据结构化完整，支持多轮AI分析
│   │   └── 质量验证检查 - 验证数据完整性和有效性
│   └── A4-1.3: 七层标签生成交互流程
│       ├── Layer 0背景信息 - 背景信息标签提取和推理(8-15个标签)
│       ├── Layer 1适配职位 - 基于背景推理适配职位标签(6-12个标签)
│       ├── Layer 2技能体系 - 技能体系和能力标签识别(10-18个标签)
│       ├── Layer 3地理位置 - 地理位置直接提取，无LLM处理
│       ├── Layer 4积极特质 - 积极特质和优势标签分析(8-12个标签)
│       ├── Layer 5限制因素 - 限制因素和发展需求标签(6-10个标签)
│       └── Layer 6潜在风险 - 潜在风险和挑战标签评估(5-8个标签)
├── A4-2: 企业标签生成流程
│   ├── A4-2.1: 雇主多次打标策略
│   │   ├── 公司基础打标 - 公司文件上传后基础打标
│   │   ├── 职位结合打标 - 每次招聘简章上传时结合公司资料重新打标该职位
│   │   └── 批量打标优化 - 企业多职位上传时采用异步并发处理，提升处理效率
│   ├── A4-2.2: 企业数据分析流程
│   │   ├── 企业文档验证处理 - 基于企业注册信息推断企业文化、管理风格、发展阶段、行业特征
│   │   ├── 观测与延申标签生成 - 观测标签(文档明确信息) + 延申标签(企业文化推断、发展潜力分析)
│   │   └── 企业标签向量化存储 - 标签ID引用，企业文档文件存储在MinIO
│   └── A4-2.3: 企业七层标签体系
│       ├── Company Layer 0 - 企业背景信息标签生成
│       ├── Company Layer 1 - 企业职位机会标签生成
│       ├── Company Layer 2 - 企业技能需求标签生成
│       ├── Company Layer 3 - 企业地理位置信息提取
│       └── Company Layer 4-6 - 企业文化环境与风险分析
├── A4-3: 职位标签生成流程
│   ├── A4-3.1: 职位打标触发机制
│   │   ├── 招聘简章上传触发 - 每次招聘简章上传时触发该简章的专项打标
│   │   └── 结合企业资料分析 - 结合企业背景信息进行职位标签生成
│   ├── A4-3.2: 职位深度分析流程
│   │   ├── 显性与隐性要求分析 - 深度分析显性要求+隐性要求，推断团队氛围、成长机会、工作压力
│   │   ├── 观测与延申标签生成 - 观测标签(明确技能要求) + 延申标签(隐含能力需求、文化适配要求)
│   │   └── 职位标签向量化存储 - 标签ID引用，jobpost文件存储在MinIO
│   └── A4-3.3: 职位七层标签体系
│       ├── JobPost Layer 0 - 职位背景信息标签生成
│       ├── JobPost Layer 1-2 - 职位技能要求标签生成
│       ├── JobPost Layer 3 - 职位地理与工作安排标签
│       └── JobPost Layer 4-6 - 职位环境挑战与成长分析
└── A4-4: 意图识别与智能分析机制
    ├── A4-4.1: 头脑风暴整体延申思考
    │   ├── 基于完整画像进行成长环境、心理状态、职业潜质的整体延申思考
    │   ├── 深度心理分析、环境影响推断生成延申标签
    │   └── 潜在特质挖掘和可能性分析
    ├── A4-4.2: 双类型标签生成处理
    │   ├── 可观测标签(tag_source: "observed") - 从原始数据直接提取的明显特征，置信度通常>0.8
    │   └── 延申可能性标签(tag_source: "extended") - LLM调用和头脑风暴产生的潜在特质，置信度通常0.5-0.8
    └── A4-4.3: ⚠️ 待补业务流程
        ├── 标签失效机制定义 - 原始数据更改时标签失效的具体规则(保守选项: 立即失效/延迟失效/手动失效)
        └── 并发标签生成限制策略 - 单用户并发限制和资源管理策略(保守选项: 3个任务/5个任务/全局20个任务)
```

------------------------------

### A5: 接口结构、状态管理、日志与异常策略

```
├── A5-1: 接口结构规范
│   ├── A5-1.1: 核心接口签名
│   │   └── async def run(request: AgentRequest) -> AgentResponse - 统一入口方法，包含请求载荷和响应载荷规范
│   ├── A5-1.2: 接口契约定义
│   │   ├── 输入参数规范 - request_id、task_type、context、additional_params
│   │   ├── 返回值规范 - request_id、agent_name、success、timestamp、response、error
│   │   ├── 异常规范 - TagGenerationError、VectorProcessingError、LayerValidationError、LLMProcessingError
│   │   └── SLA承诺 - 99.0%服务可用性、95%标签生成<8秒、95%七层标签完整度、98%标签生成成功率
│   └── A5-1.3: 错误码规范
│       ├── 统一命名格式 - TAGGING/{REASON}格式
│       ├── 标签生成错误码 - TAGGING/GENERATION_FAILED、TAGGING/LAYER_INCOMPLETE、TAGGING/VECTOR_ERROR、TAGGING/LLM_TIMEOUT、TAGGING/QUALITY_LOW
│       ├── 数据处理错误码 - TAGGING/INVALID_INPUT、TAGGING/MISSING_PROFILE、TAGGING/VALIDATION_ERROR
│       └── 触发相关错误码 - TAGGING/TRIGGER_INVALID、TAGGING/CONCURRENT_LIMIT、TAGGING/VERSION_CONFLICT
├── A5-2: 状态管理策略
│   ├── A5-2.1: 无状态设计原则
│   │   ├── 完全无状态设计 - 每次调用独立完成，不保存标签生成状态
│   │   ├── 被动调用模式 - 仅响应routing_agent的标签生成任务分发，不主动运行
│   │   └── 中枢调度机制 - 与其他模块交互统一通过routing_agent进行调度
│   ├── A5-2.2: 嵌套存储与组织策略
│   │   ├── 个人画像独立存储 - 求职者个人特质标签独立存储，不受职位变化影响
│   │   ├── 企业多维度嵌套组织 - 雇主标签按用户ID → 公司1{招聘1,招聘2,招聘3} → 公司2{招聘1,招聘2}嵌套组织
│   │   ├── 标签版本管理 - 每次重打标保留历史版本，支持变化追踪和回滚
│   │   └── 失效标签清理 - 原始数据删除时，相关标签自动失效但保留存档
│   └── A5-2.3: 打标状态枚举管理
│       ├── PENDING - 等待打标处理
│       ├── IN_PROGRESS - 正在执行打标
│       ├── COMPLETED - 打标完成
│       ├── FAILED - 打标失败需重试
│       └── SKIPPED - 跳过打标(信息不足等)
├── A5-3: 日志记录策略
│   ├── A5-3.1: 日志框架规范
│   │   ├── 使用Python标准logging模块
│   │   ├── 结构化JSON格式，包含标签生成上下文信息
│   │   ├── 禁止使用print()进行任何输出
│   │   └── 隐私保护：不记录生成的标签内容，仅记录处理元数据
│   ├── A5-3.2: 必填日志字段规范
│   │   ├── 标准字段 - request_id、module_name、operation、duration_ms、success、retry_count、timestamp
│   │   ├── 标签生成专项字段 - layer_count、generated_tag_count、vector_count、llm_model、config_version、quality_score
│   │   └── 错误日志专项字段 - error_type、error_layer_id、llm_error_details、recovery_action
│   └── A5-3.3: 稳定指标名称定义
│       ├── 核心业务指标 - taggings_agent_requests_total、taggings_agent_success_rate、taggings_agent_duration_seconds
│       ├── 七层标签体系专项指标 - taggings_agent_layer_completion_rate、taggings_agent_llm_calls_total、taggings_agent_vector_generation_total
│       └── 目标值设定 - 成功率≥98%、P95<8秒、每层≥95%完整度
└── A5-4: 异常处理策略
    ├── A5-4.1: 异常类型体系
    │   ├── TagGenerationError - 标签生成失败，包含layer_id和错误详情
    │   ├── VectorProcessingError - 向量化处理失败
    │   ├── LayerValidationError - 标签层验证失败
    │   └── LLMProcessingError - AI处理异常
    ├── A5-4.2: 异常处理机制
    │   ├── 向上传播策略 - 异常向routing_agent传播，提供详细的错误上下文
    │   ├── 用户友好处理 - 对用户屏蔽LLM技术细节，保留完整日志记录
    │   ├── try-catch捕获机制 - 记录error_type、entity_type、layer_id等上下文信息
    │   └── 降级策略支持 - 支持降级策略和错误恢复
    └── A5-4.3: 失败回退与恢复
        ├── 失败时返回可操作指令 - flow指令/重试建议/联系渠道
        ├── 质量控制机制 - 生成后立即应用+后台人工审核的异步质量管理
        └── 三态审核流程 - 批准(保持)、修改(重新语义化)、弃用(删除ID映射)
```

------------------------------

### A6: UI组件结构、事件响应、错误处理机制

```
├── A6-1: UI组件结构
│   └── ⚠️ 未定义 - taggings_agent作为后端服务模块，不涉及UI组件结构
├── A6-2: 事件响应机制
│   └── ⚠️ 未定义 - taggings_agent采用被动调用模式，通过routing_agent进行任务分发，不涉及UI事件响应
└── A6-3: 前端错误处理机制
    └── ⚠️ 未定义 - taggings_agent为后端AI标签生成服务，错误处理通过异常传播至routing_agent，不涉及前端错误处理
```

------------------------------

### A7: WebSocket / LLM / 上传机制等集成接口

```
├── A7-1: LLM集成接口
│   ├── A7-1.1: LLM调用完整规范
│   │   ├── 核心用途 - 七层标签体系(Layer 0-6)生成、实体特征分析、语义标签提取
│   │   ├── 调用方式 - 通过routing_agent.call_agent("llm_handler_agent", payload)调用
│   │   ├── 模型限制 - 强制使用gpt-4o-2024-08-06，严禁直接访问OpenAI、Claude、Gemini等API
│   │   └── 温度参数控制 - 使用配置动态获取temperature值，确保创造性标签生成
│   ├── A7-1.2: 多轮LLM交互机制
│   │   ├── 6轮独立标签生成 - Layer 0,1,2,4,5,6通过LLM进行AI分析
│   │   ├── 提示词管理 - 每层标签的专用prompt通过routing_agent.get_config()获取
│   │   ├── 语义去重机制 - 每轮生成前查询ChromaDB获取100个最相似已有标签，避免重复生成
│   │   └── 质量控制 - 生成后立即应用+后台人工审核的异步质量管理机制
│   └── A7-1.3: 三实体LLM调用扩展
│       ├── 用户实体LLM调用 - 支持用户背景、职位、技能、特质、风险分析的专用prompt模板
│       ├── 企业实体LLM调用 - 支持企业背景、职位机会、技能需求、文化环境分析的prompt模板
│       └── 职位实体LLM调用 - 支持职位背景、技能要求、工作环境、挑战成长分析的prompt模板
├── A7-2: 向量化处理集成接口
│   ├── A7-2.1: 向量生成机制
│   │   ├── embedding模型统一 - 所有标签使用gpt-4o-2024-08-06的embedding，维度一致
│   │   ├── 向量维度规范 - 使用gpt-4o生成1536维embedding向量，支持四集合架构
│   │   ├── 预生成向量策略 - 标签生成后立即向量化，支持实时匹配查询
│   │   └── cosine_similarity优化 - 向量存储格式针对余弦相似度计算优化
│   ├── A7-2.2: 向量数据库集成
│   │   ├── ChromaDB集成 - 与ChromaDB向量数据库深度集成，支持大规模语义检索
│   │   ├── 四集合架构支持 - user_profile_tags、company_profile_tags、job_post_tags、location_tags
│   │   ├── 智能去重机制 - 为系统提供语义相似性检测，避免重复标签
│   │   └── 高性能检索 - 毫秒级的向量相似性搜索，支持大规模标签库
│   └── A7-2.3: 跨集合匹配支持
│       ├── 用户↔职位匹配 - 技能+特质+地理综合评分，支持动态权重调整
│       ├── 用户↔公司匹配 - 企业文化语义适配，评估长期发展契合度
│       ├── 用户↔地理匹配 - 预设距离关系计算，支持居家办公模式切换
│       └── 职位↔公司匹配 - 岗位与企业特征匹配，确保推荐一致性
├── A7-3: 数据存储集成接口
│   ├── A7-3.1: database_agent协作机制
│   │   ├── 标签数据预格式化 - taggings_agent负责输出标签化结果，包括中央标签库更新和实体标签引用
│   │   ├── 存储格式匹配 - 输出结构必须与database_agent的存储格式完全匹配
│   │   ├── 数据流向控制 - taggings_agent → routing_agent → database_agent → ChromaDB/MongoDB
│   │   └── 校验责任分工 - database_agent仅做校验和存储，不做数据转换
│   ├── A7-3.2: MinIO文件存储集成
│   │   ├── 用户文件存储 - 用户简历文件存储在MinIO，标签采用ID引用方式
│   │   ├── 企业文件存储 - 企业文档文件存储在MinIO，标签采用ID引用方式
│   │   └── 职位文件存储 - jobpost文件存储在MinIO，标签采用ID引用方式
│   └── A7-3.3: ⚠️ 未定义集成接口
│       ├── WebSocket集成 - taggings_agent作为后端AI服务，不直接涉及WebSocket实时通信
│       └── 上传机制集成 - taggings_agent不直接处理文件上传，通过其他模块获取已处理的数据
└── A7-4: 模块协作集成接口
    ├── A7-4.1: routing_agent集成
    │   ├── 统一任务调度 - 所有标签生成任务通过routing_agent进行分发和协调
    │   ├── 配置管理集成 - 通过routing_agent.get_config()获取所有配置和参数
    │   └── 模块间通信 - 与其他模块交互统一通过routing_agent.call_agent()
    ├── A7-4.2: 业务模块协作接口
    │   ├── resume_agent协作 - 获取用户5步骤完成数据，触发用户标签生成
    │   ├── company_identity_agent协作 - 获取企业验证数据，触发企业标签生成
    │   ├── jobpost_agent协作 - 获取职位信息数据，触发职位标签生成
    │   └── matching_agent协作 - 提供预生成标签向量，支持智能匹配算法
    └── A7-4.3: 数据协作规范
        ├── 数据获取协作 - 从业务模块获取原始数据进行标签化处理
        ├── AI分析协作 - 与llm_handler_agent协作进行智能内容分析
        └── 存储协作 - 与database_agent协作进行标签数据存储和管理
```

------------------------------

### A8: 环境配置、运行要求、版本依赖、模块限制

```
├── A8-1: Python环境完整规范
│   ├── A8-1.1: 基础环境要求
│   │   ├── Python版本 - Python 3.10+ (强制要求)
│   │   ├── 运行环境 - 支持asyncio异步并发处理
│   │   ├── 依赖管理 - 使用requirements.txt管理依赖版本
│   │   └── 资源要求 - 内存1GB+，CPU 2核+ (AI标签生成计算密集)
│   ├── A8-1.2: Pydantic V2完整规范
│   │   ├── 必须使用规范 - model_validate()、model_dump()、Field()、BaseModel
│   │   ├── 严禁使用规范 - .dict()、.parse_obj()、.json()、parse_obj_as()
│   │   ├── 字段验证规范 - 必须使用pattern=r"regex"，严禁使用regex=r"regex"
│   │   ├── 模型导入规范 - 统一从global_schemas导入，禁止本地重复定义
│   │   └── 模型验证机制 - 从global_schemas导入TaggingRequest、TagLayer、TagVector模型，使用model_validate()验证输入数据，model_dump()序列化输出结果
│   └── A8-1.3: 异步处理完整规范
│       ├── 必须使用async def - 所有标签生成和向量化方法使用async def
│       ├── 禁止阻塞操作 - 禁止同步阻塞操作、threading、multiprocessing
│       ├── 并发处理机制 - 使用asyncio.create_task()、asyncio.gather()并发处理多层标签
│       └── 七层并发处理 - 使用asyncio.create_task()创建7层标签生成任务，通过asyncio.gather()并行执行多层标签生成，过滤异常后返回有效TagLayer结果
├── A8-2: 版本依赖管理
│   ├── A8-2.1: 核心依赖版本
│   │   ├── global_schemas模块 - 统一数据模型和Schema版本管理
│   │   ├── routing_agent依赖 - 配置管理和任务调度服务依赖
│   │   ├── LLM模型版本 - 强制依赖gpt-4o-2024-08-06版本
│   │   └── 向量数据库版本 - ChromaDB向量数据库版本兼容性
│   ├── A8-2.2: 服务依赖要求
│   │   ├── routing_agent - 任务调度和配置管理服务
│   │   ├── llm_handler_agent - AI标签生成服务
│   │   ├── database_agent - 数据存储和管理服务
│   │   └── ChromaDB向量数据库 - 向量存储和语义检索服务
│   └── A8-2.3: 版本兼容策略
│       ├── 向后兼容保证 - 新增/变更字段必须提供默认值和兼容策略
│       ├── Schema版本管理 - 与global_schemas保持版本同步
│       └── 配置版本控制 - 配置键名/层级变更需要迁移方案
├── A8-3: 模块架构限制
│   ├── A8-3.1: 目录与文件边界
│   │   ├── 工作区限制 - 生成和修改仅允许发生在applications/taggings_agent/内
│   │   ├── 主入口约定 - 模块主入口文件名与taggings_agent同名
│   │   ├── 粒度限制 - 单次变更仅允许操作一个文件；若超过300行，自动截断并停止
│   │   └── 结构稳定性 - 禁止新建"公共"目录；禁止在模块间互放工具文件
│   ├── A8-3.2: 职责分层边界
│   │   ├── Main层职责 - 只做策略选择、依赖装配、流程编排；禁止任何业务规则、存储访问、外部I/O
│   │   ├── Adapter层职责 - 只实现外设与机制(AI标签生成、向量处理、数据库交互等)；禁止写业务决策
│   │   ├── Aux层职责 - 仅供Main/Adapter内部复用；不得跨模块导出；禁止出现横向依赖
│   │   └── 拆分触发条件 - 当单文件同时承担两类以上变更原因或超过200行时必须拆分
│   └── A8-3.3: 外部I/O与状态限制
│       ├── 状态存取限制 - 模块不得直接访问持久化(DB/Cache/FS)；必须通过指定Adapter间接访问database_agent
│       ├── 副作用隔离 - 任何网络/系统I/O仅可写在Adapter；Main/Aux出现I/O视为违规
│       ├── 可重复执行要求 - 生成的任意函数需满足幂等/可重放要求
│       └── 并发原语限制 - 仅允许使用语言原生异步原语；禁止线程池/进程池
├── A8-4: 配置与特性限制
│   ├── A8-4.1: 配置来源限制
│   │   ├── 配置唯一来源 - 配置仅可经由routing_agent的global_config读取
│   │   ├── 禁止硬编码 - 禁止本地硬编码可变配置
│   │   └── 热更新支持 - 配置键名/层级不可私改；新增键必须提供默认值、回滚策略
│   ├── A8-4.2: 数据模型限制
│   │   ├── 模型唯一来源 - 所有数据模型/Schema一律从global_schemas引入
│   │   ├── 禁止本地定义 - 禁止在模块内新增/复制业务模型或DTO
│   │   └── 接口契约约束 - 仅声明入参/出参/错误码；不提供实现样例
│   └── A8-4.3: 安全与合规限制
│       ├── 秘钥管理 - 不得在代码/README/示例中出现任何真实秘钥
│       ├── 输入校验 - 所有外部输入必须显式校验(长度/类型/枚举/格式)
│       ├── 数据脱敏 - 在标签生成和日志中对敏感信息进行脱敏处理
│       ├── AI安全 - 确保AI生成的标签内容健康、合规、不包含歧视性内容
│       └── 权限最小化 - 仅访问标签生成必需的数据和服务
└── A8-5: 部署与监控要求
    ├── A8-5.1: 部署规范约束
    │   ├── 环境要求 - Python 3.10+，内存1GB+，CPU 2核+
    │   ├── 依赖服务 - routing_agent, llm_handler_agent, database_agent, ChromaDB向量数据库
    │   ├── 监控指标 - 标签生成成功率>98%，响应时间<8秒，七层标签完整度>95%
    │   └── 健康检查 - LLM服务连通性验证、向量数据库连接检查、标签生成质量监控
    ├── A8-5.2: 观测与审计要求
    │   ├── 日志必填字段 - request_id、module_name、operation、duration_ms、success、retry_count
    │   ├── 敏感信息处理 - 日志/错误信息不得包含密钥、令牌、身份证件、邮箱全量、手机号全量等
    │   └── 指标暴露要求 - 调用次数、成功率、时延分布三类指标
    └── A8-5.3: 测试与验收要求
        ├── 生产级测试 - 使用真实的用户、企业、职位数据进行标签生成验证
        ├── 完整流程测试 - 测试数据输入→LLM分析→七层标签生成→向量化处理→存储验证的完整链路
        ├── 多实体测试 - 验证用户、企业、职位三种实体类型的标签生成质量
        └── 性能测试 - 验证并发标签生成和大批量处理的性能表现
```

------------------------------

### A9: 测试策略、验收机制、部署策略、未来规划

```
├── A9-1: 测试策略规范
│   ├── A9-1.1: 测试覆盖范围
│   │   ├── 完整标签流程测试 - 验证generate_user_tags操作的端到端流程，包含user_id、profile_data、resume_content输入和七层标签输出验证
│   │   ├── 多层并发生成测试 - 验证七层标签并发生成的完整性，确保每层都有标签内容且layer_id正确对应
│   │   ├── 三实体标签测试 - 验证用户、企业、职位三种实体类型的标签生成质量
│   │   └── 语义向量化测试 - 验证标签向量化处理和语义相似度计算的准确性
│   ├── A9-1.2: 生产级测试要求
│   │   ├── 真实数据验证 - 使用真实的用户、企业、职位数据进行标签生成验证
│   │   ├── 完整链路测试 - 验证数据输入→LLM分析→七层标签生成→向量化处理→存储验证的完整链路
│   │   ├── 性能测试 - 验证并发标签生成和大批量处理的性能表现
│   │   └── 质量控制测试 - 验证标签生成质量评估和审核机制
│   └── A9-1.3: 测试执行规范
│       ├── 最小用例要求 - 至少提供冒烟链路与失败路径两类用例
│       ├── Mock限制规范 - 用例不得Mock掉对外契约(可Mock外设)
│       ├── 验收门槛 - 生成变更必须先通过本模块用例再提交
│       └── 测试独立管理 - 测试逻辑已迁移至utility_tools/global_test/进行独立管理
├── A9-2: 验收机制标准
│   ├── A9-2.1: SLA验收标准
│   │   ├── 可用性指标 - 99.0%服务可用性
│   │   ├── 响应时间指标 - 95%标签生成<8秒
│   │   ├── 准确性指标 - 95%七层标签完整度
│   │   └── 质量保障指标 - 98%标签生成成功率
│   ├── A9-2.2: 功能验收标准
│   │   ├── 七层标签完整性 - 每层标签生成完整度≥95%
│   │   ├── 三实体支持 - 用户、企业、职位三种实体类型标签生成成功
│   │   ├── 向量化处理 - 所有生成标签成功向量化为1536维向量
│   │   └── 语义去重效果 - 重复标签识别和过滤准确率≥90%
│   └── A9-2.3: 质量验收标准
│       ├── 标签质量评估 - 生成标签的语义准确性和相关性评估
│       ├── AI内容安全 - 确保AI生成内容健康、合规、无歧视性内容
│       ├── 数据完整性 - 标签生成过程中数据不丢失、不损坏
│       └── 异常处理完整性 - 各种异常情况下的错误处理和恢复机制
├── A9-3: 部署策略规范
│   ├── A9-3.1: 环境部署要求
│   │   ├── 系统启动方式 - 使用python main.py --start从boot/启动整个系统
│   │   ├── 模块装配机制 - 通过boot/launcher.py基于applications/__registry__.py装配
│   │   ├── 服务调用方式 - 启动后通过routing_agent进行统一调度
│   │   └── 依赖服务部署 - routing_agent、llm_handler_agent、database_agent、ChromaDB向量数据库
│   ├── A9-3.2: 配置部署策略
│   │   ├── 配置管理 - 通过routing_agent的global_config进行统一配置管理
│   │   ├── 热更新支持 - 支持配置热更新和回滚机制
│   │   ├── 环境变量管理 - 仅允许读取环境变量或安全管理器的别名
│   │   └── 版本控制 - 配置版本管理和兼容性控制
│   └── A9-3.3: 监控部署要求
│       ├── 健康检查部署 - LLM服务连通性验证、向量数据库连接检查
│       ├── 指标监控部署 - 标签生成成功率、响应时间、完整度监控
│       ├── 日志收集部署 - 结构化日志收集和分析系统
│       └── 告警机制部署 - 异常情况告警和自动恢复机制
├── A9-4: 未来规划展望
│   ├── A9-4.1: 功能扩展规划
│   │   ├── 多语言标签生成 - 支持多语言实体的标签生成和语义理解
│   │   ├── 实时标签更新 - 支持实体信息实时变化的增量标签更新
│   │   ├── 自定义标签体系 - 支持不同行业和场景的定制化标签体系
│   │   └── 标签关系图谱 - 构建更复杂的标签语义关系网络
│   ├── A9-4.2: 性能优化规划
│   │   ├── 批处理优化 - 大规模标签生成的批处理性能优化
│   │   ├── 缓存机制 - 常用标签和向量的智能缓存机制
│   │   ├── 模型优化 - LLM调用效率和准确性的持续优化
│   │   └── 向量计算优化 - 大规模向量相似度计算的性能优化
│   ├── A9-4.3: 智能化规划
│   │   ├── 自适应质量控制 - 基于历史数据的智能质量评估和优化
│   │   ├── 个性化标签生成 - 基于用户反馈的个性化标签优化
│   │   ├── 标签推荐系统 - 智能标签推荐和补全机制
│   │   └── 异常检测与自动修复 - AI驱动的异常检测和自动修复能力
│   └── A9-4.4: 生态集成规划
│       ├── 第三方集成 - 与更多第三方AI服务和数据源的集成
│       ├── API开放计划 - 标签生成服务的API开放和生态建设
│       ├── 数据标准化 - 行业标准化的标签数据格式和协议
│       └── 跨系统互操作 - 与其他HR和招聘系统的互操作能力
└── A9-5: ⚠️ 未来规划待定项
    ├── 标签质量评估模型 - 标签质量评估的标准和指标需要进一步明确
    ├── 多模型支持策略 - 是否支持除gpt-4o外的其他LLM模型需要评估
    ├── 跨地区部署方案 - 不同地区的部署和合规要求需要考虑
    └── 成本控制策略 - LLM调用成本的长期控制和优化策略需要制定
```

------------------------------

### A10: 未定义项、待补要点、黑名单、禁用规则等

```
├── A10-1: 配置参数待补清单
│   ├── A10-1.1: AI标签质量阈值定义
│   │   ├── 配置键名 - quality_config.minimum_tag_quality_score
│   │   ├── 需要明确 - 具体数值阈值和评估算法
│   │   ├── 影响面 - 标签生成质量控制和系统匹配准确性
│   │   └── 保守选项 - 选项1: 0.8(80%)阈值平衡质量和效率；选项2: 0.7(70%)阈值宽松策略提高成功率；选项3: 0.6(60%)阈值最宽松可接受线
│   ├── A10-1.2: LLM调用超时参数定义
│   │   ├── 配置键名 - llm_config.request_timeout_seconds
│   │   ├── 需要明确 - 单次LLM调用的超时时间和重试策略
│   │   ├── 影响面 - 标签生成性能和稳定性
│   │   └── 保守选项 - 选项1: 30秒平衡响应时间和成功率；选项2: 60秒宽松超时提高复杂标签成功率；选项3: 120秒最宽松适用于高复杂度分析
│   └── A10-1.3: 并发限制参数定义
│       ├── 需要明确 - 单用户并发限制和资源管理策略
│       ├── 影响面 - 系统性能和LLM API成本控制
│       └── 保守选项 - 选项1: 单用户最多3个任务平衡性能和体验；选项2: 单用户最多5个任务更高效率但可能影响稳定性；选项3: 全局限制最多20个任务总体控制
├── A10-2: Schema模型字段待补清单
│   ├── A10-2.1: 三实体标签统一格式定义
│   │   ├── 模型名称 - EntityTagResult
│   │   ├── 需要明确 - 用户/企业/职位三类实体的标签结果统一格式
│   │   ├── 影响面 - 标签数据交换和database_agent存储集成
│   │   └── 保守选项 - 选项1: 统一JSON格式简单直接；选项2: 分实体类型定义类型安全但复杂；选项3: 使用现有global_schemas最小改动
│   └── A10-2.2: 标签质量评估模型
│       ├── 模型名称 - TagQualityAssessment
│       ├── 需要明确 - 标签质量评估的标准和指标
│       ├── 影响面 - 标签质量控制和人工审核流程
│       └── 保守选项 - 选项1: 简单评分模型(0.0-1.0)易实现；选项2: 多维度评估模型更全面但复杂；选项3: 基于规则的评估可解释性强
├── A10-3: 业务流程待明确清单
│   ├── A10-3.1: 标签失效机制定义
│   │   ├── 需要明确 - 原始数据更改时标签失效的具体规则
│   │   ├── 影响面 - 数据一致性和存储管理
│   │   └── 保守选项 - 选项1: 立即失效保持一致性但可能过于严格；选项2: 延迟失效平衡性能和一致性；选项3: 手动失效最简单但需人工干预
│   └── A10-3.2: 多模型支持策略
│       ├── 需要明确 - 是否支持除gpt-4o-2024-08-06外的其他LLM模型
│       ├── 影响面 - 系统灵活性和成本控制
│       └── 保守选项 - 选项1: 仅支持当前模型保持稳定性；选项2: 支持多模型切换增加灵活性；选项3: 分场景使用不同模型
├── A10-4: 开发边界黑名单规则
│   ├── A10-4.1: 禁止本地业务模型定义
│   │   ├── 黑名单关键词 - "class .*Model", "data class .*", "interface .*DTO"
│   │   └── 执行规则 - 所有数据模型必须从global_schemas引入
│   ├── A10-4.2: 禁止硬编码配置
│   │   ├── 黑名单关键词 - "API_KEY=", "timeout\\s*=\\s*\\d+", "retry\\s*=\\s*\\d+"
│   │   └── 执行规则 - 所有配置通过routing_agent.get_config()获取
│   ├── A10-4.3: 禁止跨层I/O操作
│   │   ├── 黑名单关键词 - 在Main/Aux中出现"http", "db", "sql", "open(", "requests", "fetch"
│   │   └── 执行规则 - I/O操作仅可在Adapter层实现
│   ├── A10-4.4: 禁止并发越界操作
│   │   ├── 黑名单关键词 - "Thread", "Process", "fork", "Pool"
│   │   └── 执行规则 - 仅允许使用语言原生异步原语
│   └── A10-4.5: 禁止未脱敏日志
│       ├── 黑名单关键词 - "print(", "console.log(", "logging.info(f\\".*password|token|secret"
│       └── 执行规则 - 日志必须脱敏处理敏感信息
├── A10-5: 安全合规禁用规则
│   ├── A10-5.1: 秘钥管理禁用
│   │   └── 不得在代码/README/示例中出现任何真实秘钥，仅允许读取环境变量或安全管理器的别名
│   ├── A10-5.2: 输入校验禁用绕过
│   │   └── 所有外部输入必须显式校验长度/类型/枚举/格式，校验规则写入README的契约章节
│   ├── A10-5.3: 数据脱敏强制要求
│   │   └── 在标签生成和日志中对敏感信息进行脱敏处理，AI生成的标签内容必须健康、合规、不包含歧视性内容
│   └── A10-5.4: 权限最小化原则
│       └── 仅访问标签生成必需的数据和服务，禁止访问超出职责范围的系统资源
└── A10-6: 生成器执行禁用规则
    ├── A10-6.1: 禁止脑补机制
    │   └── 遇到缺失信息(路径/键名/Schema字段/错误码)，停止输出并在README的"待补要点"清单中列明，不得擅自发明
    ├── A10-6.2: 禁止反向依赖
    │   └── Domain → Adapter单向依赖；Aux不得被跨模块引用。生成器如果检测到反向引用，直接终止
    ├── A10-6.3: 禁止文件操作越权
    │   └── 不迁移/不重命名/不删除，除非README的"迁移方案"明确列出变更映射
    ├── A10-6.4: 禁止新增公共层
    │   └── 任何"utils/common/shared"目录新增一律拒绝；确有必要需先在顶层规范中建制并评审
    └── A10-6.5: 禁止跨边界操作
        └── 生成和修改仅允许发生在applications/taggings_agent/内，禁止创建、移动、重命名、删除该目录外的任何文件/目录
```

