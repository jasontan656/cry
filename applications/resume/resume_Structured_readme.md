# resume_agent - 结构化文档骨架

## 文档重构说明
本文档基于原始readme.md进行结构化重建，覆盖所有信息价值内容，按照标准化编号体系组织。

---

### A: 开发边界与职责说明

```
resume_agent是Career Bot系统的简历解析与用户画像构建中心，负责处理用户上传的简历文件，提取关键信息，并结合多轮对话收集补充信息，构建完整的用户基础画像。该模块是用户画像生成的起点，为后续的MBTI测试、天赋分析和综合报告提供基础数据支撑。
```

------------------------------

### A1: 模块基本定义

```
resume_agent是Career Bot系统的简历解析与用户画像构建中心，负责处理用户上传的简历文件，提取关键信息，并结合多轮对话收集补充信息，构建完整的用户基础画像。该模块是用户画像生成的起点，为后续的MBTI测试、天赋分析和综合报告提供基础数据支撑。
```

------------------------------

### A2: 核心功能特性

```
A-2.1: 简历文件解析
├── A-2.1.1: 多格式支持 - 支持PDF、DOC、DOCX等常见简历格式
├── A-2.1.2: 智能提取 - 基于AI的关键信息自动提取
├── A-2.1.3: 结构化处理 - 将非结构化简历内容转换为结构化数据
└── A-2.1.4: 质量验证 - 确保提取信息的准确性和完整性

A-2.2: 多轮对话补充
├── A-2.2.1: 信息补全 - 通过对话收集简历中缺失的关键信息
├── A-2.2.2: 数据验证 - 确认和验证简历解析的准确性
├── A-2.2.3: 个性化收集 - 收集个人偏好和期望等主观信息
└── A-2.2.4: 动态调整 - 根据用户反馈调整信息收集策略

A-2.3: 重新上架机制
├── A-2.3.1: 一键重新上架 - 下架用户点击"我要求职"即可重新上架，无需重新测试流程
├── A-2.3.2: 购买计数重置 - 重新上架后购买次数重置为0，重新进入匹配池
├── A-2.3.3: 数据保持完整 - 重新上架时用户历史数据和标签完全保留
└── A-2.3.4: 搜索历史不清空 - 重新上架时不清空已有搜索历史记录，已搜索过的雇主仍看不到该用户
```

------------------------------

### A3: 术语与名词统一定义

```
A-3.1: 核心概念统一定义
├── A-3.1.1: 重新上架 - 下架用户通过"我要求职"按钮恢复求职状态的完整流程，包含数据保留、计数重置、状态更新
├── A-3.1.2: 26字段标准 - 用户画像构建的完整字段规范，已迁移至global_schemas.json中的Resume26Fields模型，由routing_agent在系统启动时动态生成并分发
├── A-3.1.3: 5步骤完整性 - 求职者必须按顺序完成的完整流程：MBTI测试→反向测试→出生日期→简历上传→补充信息，缺一不可
├── A-3.1.4: 多轮对话补充 - 基于AI提取结果的不完整字段，通过最多5轮人机对话收集完善信息的机制
└── A-3.1.5: 完整度阈值 - 统一设定为0.9（90%），用于判断用户画像数据质量是否达到进入匹配流程的标准
```

------------------------------

### B: 系统架构与模块定义

```
B-1: 上游触发模块
├── B-1.1: routing_agent - 唯一任务调度来源，提供简历处理任务分发和配置管理
├── B-1.2: auth_agent - 求职者身份激活后触发简历上传和处理流程
├── B-1.3: frontend_service_agent - 用户上传简历文件或点击重新上架后触发处理
└── B-1.4: database_agent - 用户信息更新时触发简历重新解析和画像更新

B-2: 下游调用模块
├── B-2.1: llm_handler_agent - AI简历解析、信息提取和对话问题生成
├── B-2.2: database_agent - 简历数据存储、用户画像构建和重新上架状态管理
├── B-2.3: taggings_agent - 5步骤完成后触发求职者一次性打标
└── B-2.4: matching_agent - 提供完整用户画像用于匹配计算

B-3: 数据约束关系
├── B-3.1: 5步骤完整性 - 必须完成MBTI+反向测试+出生日期+简历+补充信息全部5个步骤
├── B-3.2: 26字段标准 - 基于预定义26字段标准确保简历信息完整性
├── B-3.3: 多轮对话支持 - 支持最多5轮对话收集缺失信息
└── B-3.4: 重新上架简化 - 下架用户重新上架时直接恢复，无需重新完成5步骤完整性

B-4: 过滤去重历史维度
├── B-4.1: 简历版本管理 - 用户上传新简历时保留历史版本便于对比
├── B-4.2: 对话历史保持 - 重新上架时保留历史对话记录和补充信息
├── B-4.3: 购买历史重置 - 重新上架后购买计数重置但不影响搜索历史
└── B-4.4: 用户状态跟踪 - 跟踪用户从注册到完成到下架到重新上架的完整状态转换

B-5: 并发顺序性约束
├── B-5.1: 5步骤顺序 - 严格按照MBTI→反向测试→出生日期→简历→补充信息顺序进行
├── B-5.2: 打标触发时机 - 仅在5步骤全部完成后一次性触发taggings_agent
└── B-5.3: 重新上架即时 - 重新上架请求立即处理，无需等待其他流程完成
```

------------------------------

### C: 输入输出规范

```
C-1: 输入数据规范
├── C-1.1: 简历文件输入
│   ├── 支持格式: PDF、DOC、DOCX、JPG等常见简历格式
│   ├── 文件大小限制: 最大10MB，最小1KB
│   ├── 内容要求: 文本长度>100字符，包含基本个人信息
│   └── 质量要求: 文件完整、可读取、非损坏状态
├── C-1.2: 用户基础信息输入
│   ├── 用户ID: 必填，来自auth_agent的身份验证
│   ├── 会话信息: 包含请求ID、时间戳、用户状态
│   └── 任务类型: resume_parse、information_complete、data_validate等
└── C-1.3: 对话补充输入
    ├── 用户回答: 结构化表单数据或自然语言回答
    ├── 字段路径: 指明回答对应的具体字段位置
    └── 会话上下文: 包含历史对话记录和当前进度

C-2: 输出数据规范
├── C-2.1: 用户画像输出
│   ├── 26标准字段: 完整的用户基础画像数据结构
│   ├── 数据完整度: 浮点数评分，范围0.0-1.0
│   ├── 字段质量评估: 每个字段的质量评分和验证状态
│   └── 元数据信息: 处理时间戳、数据来源、验证方法等
├── C-2.2: 对话问题输出
│   ├── 问题结构: 包含问题ID、字段路径、问题文本、输入类型
│   ├── 验证规则: 每个问题的回答验证标准和格式要求
│   └── 引导信息: 填写建议、示例答案、质量要求说明
└── C-2.3: 流程控制输出
    ├── 处理状态: 当前处理阶段和完成情况
    ├── 下一步指令: 前端需要执行的后续操作
    └── 错误信息: 详细的错误描述和解决建议
```

------------------------------

### D: 配置机制

```
D-1: 配置获取机制
├── D-1.1: 配置来源 - 通过routing_agent.get_config("resume_agent", config_type)获取
├── D-1.2: 配置类型 - "parsing_config", "conversation_templates", "llm_prompts", "validation_rules"
├── D-1.3: 热更新支持 - 支持配置实时更新，无需重启服务
└── D-1.4: 默认值机制 - 所有配置项必须提供默认值和回滚策略

D-2: 解析配置参数
├── D-2.1: 文件处理配置
│   ├── max_file_size: 最大文件大小限制（默认10MB）
│   ├── supported_formats: 支持的文件格式列表
│   ├── extraction_timeout: 文件解析超时时间（默认30秒）
│   └── quality_threshold: 解析质量最低阈值（默认0.7）
├── D-2.2: AI提取配置
│   ├── model_name: 使用的LLM模型（gpt-4o-2024-08-06）
│   ├── extraction_prompt_template: 信息提取的prompt模板
│   ├── max_retry_count: 最大重试次数（默认3次）
│   └── confidence_threshold: 提取置信度阈值（默认0.8）
└── D-2.3: 对话配置
    ├── max_conversation_rounds: 最大对话轮数（默认5轮）
    ├── completeness_threshold: 完整度阈值（默认0.9）
    ├── question_templates: 各字段类型的问题模板
    └── validation_prompts: 回答质量检测的prompt模板

D-3: 字段验证配置
├── D-3.1: 必填字段配置 - 18个必填字段的验证规则和格式要求
├── D-3.2: 推荐字段配置 - 5个推荐字段的收集策略和权重设置
├── D-3.3: 可选字段配置 - 3个可选字段的处理方式和默认值
└── D-3.4: 数据格式配置 - 各字段的数据类型、格式规范、校验规则

⚠️ 未定义: 具体的配置键名、取值范围、优先级设置等详细参数
```

------------------------------

### E: 模型路径

```
E-1: LLM模型调用路径
├── E-1.1: 调用通道 - 必须通过routing_agent.call_agent("llm_handler_agent", payload)
├── E-1.2: 模型指定 - 强制使用gpt-4o-2024-08-06
├── E-1.3: Prompt管理 - 通过global_config获取，禁止硬编码
└── E-1.4: 严禁直接调用 - 不得直接访问OpenAI、Claude、Gemini等API

E-2: 数据模型路径
├── E-2.1: Schema来源 - 统一从global_schemas导入，禁止本地重复定义
├── E-2.2: 必须使用的Schema - AgentRequest、AgentResponse、UserProfile、ResumeData
├── E-2.3: 模块特定Schema - ParseResult、ValidationResult、ConversationQuestion
└── E-2.4: 版本兼容 - 任何新增/变更字段必须在README标注语义、默认值、兼容策略

⚠️ 未定义: 具体的Schema字段定义、版本管理策略
```

------------------------------

### F: 调用方式

```
F-1: 统一入口接口
├── F-1.1: 接口定义 - async def run(request: AgentRequest) -> AgentResponse
├── F-1.2: 支持的任务类型 - resume_parse、information_complete、data_validate、profile_build、health_check
├── F-1.3: 被动调用模式 - 仅响应routing_agent的任务分发，不主动运行
└── F-1.4: 无状态设计 - 每次调用独立完成，不保存处理状态

F-2: 模块间协作调用
├── F-2.1: 中枢调度 - 与其他模块交互统一通过routing_agent.call_agent()
├── F-2.2: 禁止直接通信 - 模块不可直接调用其他模块
├── F-2.3: 功能声明 - 只声明所需功能，routing_agent根据功能需求进行路由
└── F-2.4: 结果传递 - 模块处理结果通过routing_agent转发给目标模块

F-3: 异步处理调用
├── F-3.1: 异步方法 - 所有简历解析和对话处理方法使用async def
├── F-3.2: 并发处理 - 使用asyncio.create_task(), asyncio.gather()处理并发文件解析
├── F-3.3: 禁止同步阻塞 - 不使用threading、multiprocessing
└── F-3.4: 超时控制 - 通过global_config注入超时和重试参数

⚠️ 未定义: 具体的调用参数格式、返回值结构
```

------------------------------

### G: 用户流程

```
G-1: 简历上传流程
├── G-1.1: 触发条件 - 前端用户上传简历文件 → entry_agent → routing_agent → resume_agent
├── G-1.2: 文件接收 - 通过AgentRequest接收文件上传任务和用户基础信息
├── G-1.3: 格式识别 - 自动识别PDF、DOC、DOCX、JPG等格式
├── G-1.4: 文件存储 - 通过routing_agent调用frontend_service_agent将文件存储至MinIO
└── G-1.5: 状态初始化 - 创建用户处理状态，返回"需要AI提取"的next_intents

G-2: AI信息提取流程
├── G-2.1: 触发条件 - 收到前端"开始AI提取"意图 → routing_agent → resume_agent
├── G-2.2: LLM调用 - 通过routing_agent请求llm_handler_agent进行简历内容提取
├── G-2.3: 智能提取 - 使用gpt-4o-2024-08-06对简历进行26字段结构化提取
├── G-2.4: 提取规则 - 从global_config获取简历提取prompt模板和字段验证规则
├── G-2.5: 初步验证 - AI提取结果进行格式校验和逻辑一致性检查
└── G-2.6: 补充标记 - 标记需要进一步补充或说明的字段

G-3: 多轮对话补充流程
├── G-3.1: 问题生成 - 对不完整、不合规字段生成针对性对话问题
├── G-3.2: 前端展示 - 生成结构化表单问题，返回给前端展示
├── G-3.3: 用户回答 - 用户回答问题 → entry_agent → routing_agent → resume_agent
├── G-3.4: 质量检测 - 通过llm_handler_agent检查用户回答的完整性和合规性
├── G-3.5: 字段更新 - 将合格回答更新到对应字段，不合格回答继续追问
└── G-3.6: 循环控制 - 最多5轮对话，达到完整度阈值后结束

G-4: 重新上架流程
├── G-4.1: 触发条件 - 下架用户点击"我要求职"按钮
├── G-4.2: 一键重新上架 - 直接重新上架，无需重新完成测试流程
├── G-4.3: 数据保留 - 用户的所有历史数据、标签、对话记录完全保留
├── G-4.4: 购买计数重置 - 被购买次数重置为0，重新开始计数周期
└── G-4.5: 搜索历史保持 - 不清空搜索记录，已被搜索过的雇主仍看不到该用户

⚠️ 未定义: 具体的流程状态转换、异常处理机制
```

------------------------------

### H: 对话流程

```
H-1: 对话问题生成策略
├── H-1.1: 问题模板获取 - 根据字段类型和缺失情况，从global_config获取对应的问题模板
├── H-1.2: 工作经历补充模板 - 针对工作经历的详细询问策略
├── H-1.3: 家庭背景补充模板 - 针对家庭背景的完整性要求
└── H-1.4: 验证标准 - 每个模板包含验证标准和追问策略

H-2: 前端表单自动生成
├── H-2.1: 结构化问题数据 - resume_agent返回结构化问题数据
├── H-2.2: 表单类型生成 - 前端根据字段类型生成对应表单
├── H-2.3: 问题结构 - 包含问题ID、字段路径、问题文本、输入类型、验证规则
└── H-2.4: 复杂表单支持 - 支持结构化表单和子字段处理

H-3: 用户回答质量检测循环
├── H-3.1: 质量检测触发 - 用户提交回答后，通过LLM再次检测质量
├── H-3.2: 质量检测Prompt - 判断回答充分性、具体信息、质量评分
├── H-3.3: 阈值判断 - 基于0.9统一阈值判断回答质量
└── H-3.4: 追问机制 - 不合格则生成针对性追问继续对话循环

H-4: 对话状态管理
├── H-4.1: 状态跟踪 - 会话ID、对话轮次、待补充字段、用户回答历史
├── H-4.2: 前端展示协调 - 进度条、字段高亮、智能提示、保存机制
├── H-4.3: 智能引导 - 根据字段类型提供填写建议和质量要求
└── H-4.4: 断点续传 - 支持用户中途退出，下次继续未完成的步骤

⚠️ 未定义: 具体的对话模板内容、质量评分算法
```

------------------------------

### I: 意图识别机制

```
I-1: 任务意图识别
├── I-1.1: 任务类型识别 - resume_parse、information_complete、data_validate、profile_build、health_check
├── I-1.2: 前端意图驱动 - 根据前端意图和模块需求进行任务路由转发
├── I-1.3: 意图状态管理 - 跟踪当前处理阶段和用户操作意图
└── I-1.4: 流程指令返回 - 返回flow_directive指示前端进入下一个流程

I-2: 用户操作意图
├── I-2.1: 文件上传意图 - 识别用户上传简历文件的操作意图
├── I-2.2: 信息补充意图 - 识别用户回答补充问题的意图
├── I-2.3: 重新上架意图 - 识别下架用户点击"我要求职"的意图
└── I-2.4: 数据验证意图 - 识别用户确认或修改信息的意图

I-3: 系统响应意图
├── I-3.1: 处理状态反馈 - 向前端反馈当前处理状态和进度
├── I-3.2: 问题生成意图 - 生成针对性问题引导用户补充信息
├── I-3.3: 数据传递意图 - 完成处理后传递数据给下游模块
└── I-3.4: 错误处理意图 - 处理异常情况并提供解决方案

⚠️ 未定义: 具体的意图识别算法、状态转换规则
```

------------------------------

### J: 接口结构

```
J-1: 核心接口规范
├── J-1.1: 统一入口接口 - async def run(request: AgentRequest) -> AgentResponse
├── J-1.2: 支持的任务类型 - resume_parse、information_complete、data_validate、profile_build、health_check
├── J-1.3: 被动调用模式 - 仅响应routing_agent的任务分发，不主动运行
└── J-1.4: 无状态设计 - 每次调用独立完成，不保存处理状态

J-2: 数据接口规范
├── J-2.1: 输入接口 - AgentRequest格式，包含任务类型、用户信息、文件数据、会话上下文
├── J-2.2: 输出接口 - AgentResponse格式，包含处理结果、状态信息、下一步指令
├── J-2.3: 错误接口 - 标准化错误码和错误信息格式
└── J-2.4: 配置接口 - 通过routing_agent获取配置的标准化接口

J-3: 模块协作接口
├── J-3.1: LLM调用接口 - 通过routing_agent调用llm_handler_agent的标准化接口
├── J-3.2: 数据存储接口 - 通过routing_agent调用database_agent的标准化接口
├── J-3.3: 文件存储接口 - 通过routing_agent调用frontend_service_agent的MinIO存储接口
└── J-3.4: 标签触发接口 - 完成后触发taggings_agent的标准化接口

⚠️ 未定义: 具体的接口参数格式、返回值结构定义
```

------------------------------

### K: 状态管理

```
K-1: 用户状态管理
├── K-1.1: 状态转换 - 激活→暂停(2次购买)→下架(10次购买)→重新上架状态转换明确
├── K-1.2: 无感知暂停 - 2次购买暂停期间用户完全无感知，不显示暂停状态
├── K-1.3: 下架通知 - 10次购买下架时通过mail_agent发送积极的"备受关注"通知
└── K-1.4: 重新上架流畅 - 重新上架流程简化，用户体验友好

K-2: 处理状态管理
├── K-2.1: 5步骤状态跟踪 - MBTI测试→反向测试→出生日期→简历上传→补充信息的完成状态
├── K-2.2: 简历处理状态 - 文件上传→AI提取→质量检测→对话补充→数据完成的处理状态
├── K-2.3: 对话会话状态 - 会话ID、对话轮次、待补充字段、用户回答历史
└── K-2.4: 数据完整性状态 - 26字段的完成情况、质量评分、验证状态

K-3: 模块内部状态
├── K-3.1: 无状态设计 - resume_agent本身不保存任何状态信息
├── K-3.2: 状态传递 - 所有状态信息通过AgentRequest和AgentResponse传递
├── K-3.3: 状态持久化 - 状态信息由database_agent统一管理和持久化
└── K-3.4: 状态同步 - 通过routing_agent确保状态在各模块间的同步

⚠️ 未定义: 具体的状态字段定义、状态转换规则
```

------------------------------

### L: 日志与异常策略

```
L-1: 日志记录规范
├── L-1.1: 日志框架 - 使用Python标准logging模块
├── L-1.2: 必要字段 - request_id, agent_name, user_id, processing_stage, file_type
├── L-1.3: 结构化日志 - JSON格式，包含简历处理上下文信息
└── L-1.4: 禁止print输出 - 严禁使用print()进行任何输出

L-2: 敏感信息保护
├── L-2.1: 数据脱敏 - 日志/错误信息不得包含密钥、令牌、身份证件、邮箱全量、手机号全量等
├── L-2.2: 个人信息保护 - 简历内容、个人详细信息不得完整记录在日志中
├── L-2.3: 安全审计 - 记录关键操作和安全相关事件
└── L-2.4: 权限最小化 - 文件处理安全、数据脱敏、权限最小化

L-3: 异常处理策略
├── L-3.1: 统一重试机制 - 所有简历处理失败情况统一要求重新上传，再次尝试
├── L-3.2: 异常类型定义 - ResumeParsingError, ConversationValidationError, DataQualityError
├── L-3.3: 向上传播 - 异常向routing_agent传播，提供详细的错误上下文
└── L-3.4: 零容错简化处理 - 文件解析失败、对话异常等所有错误统一返回失败状态

L-4: 技术支持策略
├── L-4.1: 用户友好反馈 - 提供明确失败原因和重新上传指导，包含一键技术支持邮件功能
├── L-4.2: 技术支持邮件 - 如果用户碰到无法处理的问题，提供support@4waysgroup.com邮件联系方式
├── L-4.3: 一键邮件模板 - 自动收集简历处理问题信息，生成技术支持邮件模板供用户复制发送
└── L-4.4: 问题信息收集 - 自动收集错误类型、文件信息、处理阶段等关键信息

⚠️ 未定义: 具体的日志格式、异常处理流程
```

------------------------------

### M: UI组件结构

```
M-1: 前端组件协作
├── M-1.1: 文件上传组件 - 支持拖拽上传、格式验证、进度显示
├── M-1.2: 信息展示组件 - 显示AI提取的用户信息，支持编辑和确认
├── M-1.3: 对话表单组件 - 动态生成的结构化表单，支持多种输入类型
└── M-1.4: 进度指示组件 - 显示5步骤完成进度和当前处理状态

M-2: 用户交互设计
├── M-2.1: 简历上传交互 - 直观的文件上传界面，支持预览和重新上传
├── M-2.2: 信息确认交互 - AI提取信息的展示和用户确认机制
├── M-2.3: 对话补充交互 - 友好的问答界面，提供填写建议和验证反馈
└── M-2.4: 重新上架交互 - 简单的一键重新上架按钮和状态提示

M-3: 数据展示组件
├── M-3.1: 用户画像展示 - 26字段的结构化展示，突出完整度和质量
├── M-3.2: 处理状态展示 - 实时显示处理进度和当前阶段
├── M-3.3: 错误信息展示 - 友好的错误提示和解决建议
└── M-3.4: 历史记录展示 - 显示用户的简历历史和对话记录

⚠️ 未定义: 具体的UI设计规范、组件接口定义
```

------------------------------

### N: 事件响应

```
N-1: 用户事件响应
├── N-1.1: 文件上传事件 - 响应用户上传简历文件的事件
├── N-1.2: 信息确认事件 - 响应用户确认或修改AI提取信息的事件
├── N-1.3: 对话回答事件 - 响应用户回答补充问题的事件
└── N-1.4: 重新上架事件 - 响应下架用户点击重新上架按钮的事件

N-2: 系统事件响应
├── N-2.1: AI提取完成事件 - 响应LLM完成信息提取的事件
├── N-2.2: 质量检测事件 - 响应数据质量检测完成的事件
├── N-2.3: 对话轮次事件 - 响应对话轮次变化的事件
└── N-2.4: 流程完成事件 - 响应5步骤完成的事件

N-3: 异常事件响应
├── N-3.1: 文件解析失败事件 - 响应简历文件解析失败的异常事件
├── N-3.2: LLM调用失败事件 - 响应大模型调用失败的异常事件
├── N-3.3: 数据验证失败事件 - 响应数据验证失败的异常事件
└── N-3.4: 超时事件 - 响应处理超时的异常事件

⚠️ 未定义: 具体的事件处理机制、事件传播规则
```

------------------------------

### O: 错误处理机制

```
O-1: 错误码规范
├── O-1.1: 标准错误码格式 - 使用RESUME/{REASON}命名格式
├── O-1.2: 文件处理相关错误码 - RESUME/PARSE_FAILED、RESUME/INVALID_FORMAT、RESUME/FILE_SIZE_ERROR
├── O-1.3: 数据处理相关错误码 - RESUME/EXTRACTION_FAILED、RESUME/VALIDATION_ERROR、RESUME/COMPLETENESS_LOW
├── O-1.4: LLM处理相关错误码 - RESUME/LLM_TIMEOUT、RESUME/LLM_QUOTA_EXCEEDED、RESUME/LLM_ERROR
└── O-1.5: 系统相关错误码 - RESUME/SYSTEM_ERROR、RESUME/CONFIG_ERROR、RESUME/NETWORK_ERROR

O-2: 统一处理原则
├── O-2.1: 所有简历解析失败场景均要求重新上传，不提供特殊处理路径
├── O-2.2: 提供一键技术支持邮件模板生成功能：support@4waysgroup.com
├── O-2.3: 失败反馈包含明确原因 + 重新上传指导 + 邮件支持选项
└── O-2.4: 异常向routing_agent传播，提供详细的错误上下文

O-3: 错误处理流程
├── O-3.1: 错误捕获 - 在关键处理节点捕获各类异常
├── O-3.2: 错误分类 - 根据错误类型进行分类处理
├── O-3.3: 错误记录 - 记录详细的错误信息和上下文
└── O-3.4: 错误反馈 - 向用户提供友好的错误提示和解决方案

⚠️ 未定义: 具体的错误处理流程、错误恢复机制
```

------------------------------

### P: WebSocket集成接口

```
P-1: WebSocket通信机制
├── P-1.1: 实时状态推送 - 通过WebSocket向前端推送处理状态和进度更新
├── P-1.2: 对话交互支持 - 支持实时的对话问答交互
├── P-1.3: 文件处理进度 - 实时推送文件解析和AI提取的进度信息
└── P-1.4: 错误状态通知 - 及时推送错误信息和处理结果

P-2: 消息格式规范
├── P-2.1: 状态更新消息 - 包含处理阶段、完成百分比、当前操作等信息
├── P-2.2: 对话消息 - 包含问题内容、回答要求、验证规则等信息
├── P-2.3: 错误消息 - 包含错误类型、错误描述、解决建议等信息
└── P-2.4: 完成消息 - 包含最终结果、数据完整度、下一步指令等信息

⚠️ 未定义: 具体的WebSocket消息格式、通信协议
```

------------------------------

### Q: LLM集成机制

```
Q-1: LLM调用规范
├── Q-1.1: 唯一通道 - 必须通过routing_agent.call_agent("llm_handler_agent", payload)
├── Q-1.2: 严禁直接调用 - 不得直接访问OpenAI、Claude、Gemini等API
├── Q-1.3: 模型指定 - 强制使用gpt-4o-2024-08-06
└── Q-1.4: Prompt管理 - 通过global_config获取，禁止硬编码

Q-2: 信息提取机制
├── Q-2.1: 简历内容提取 - 使用标准化prompt模板进行26字段结构化提取
├── Q-2.2: 质量评估 - 对提取结果进行质量评分和完整性检查
├── Q-2.3: 缺失标记 - 标记需要进一步补充或说明的字段
└── Q-2.4: 置信度评分 - 生成提取置信度评分

Q-3: 对话质量检测
├── Q-3.1: 回答质量检测 - 判断用户回答的充分性、具体信息、质量评分
├── Q-3.2: 阈值判断 - 基于0.9统一阈值判断回答质量
├── Q-3.3: 追问生成 - 对不合格回答生成针对性追问
└── Q-3.4: 验证循环 - 支持多轮质量检测和改进循环

⚠️ 未定义: 具体的Prompt模板内容、质量评分算法
```

------------------------------

### R: 上传机制

```
R-1: 简历上传集成
├── R-1.1: resume_agent调度 - 通过routing_agent调度简历处理任务
├── R-1.2: 上传状态管理 - resume_upload状态的流程控制
├── R-1.3: 解析失败处理 - 简历解析失败的统一处理机制
└── R-1.4: 重试上传支持 - resume_upload_retry状态支持

R-2: 文件上传处理
├── R-2.1: 多格式支持 - 支持PDF、DOC、DOCX、JPG等常见简历格式
├── R-2.2: 文件大小限制 - 最大10MB，最小1KB
├── R-2.3: 格式验证 - 自动识别和验证文件格式
└── R-2.4: 安全检查 - 文件安全扫描和恶意内容检测

R-3: 文件存储机制
├── R-3.1: MinIO存储 - 通过routing_agent调用frontend_service_agent将文件存储至MinIO
├── R-3.2: 版本管理 - 用户上传新简历时保留历史版本便于对比
├── R-3.3: 访问控制 - 确保文件访问权限和安全性
└── R-3.4: 备份策略 - 重要文件的备份和恢复机制

R-4: 通用上传优化
├── R-4.1: 文件格式验证 - 支持PDF、DOC、DOCX等格式
├── R-4.2: 文件大小限制 - 上传文件大小的限制机制
├── R-4.3: 上传进度跟踪 - 文件上传进度的状态跟踪
└── R-4.4: 临时文件清理 - 上传临时文件的清理机制

R-5: 文件处理流程
├── R-5.1: 上传接收 - 接收用户上传的简历文件
├── R-5.2: 格式转换 - 将各种格式转换为统一的文本格式
├── R-5.3: 内容提取 - 提取文件中的文本内容
└── R-5.4: 质量检查 - 检查提取内容的质量和完整性

⚠️ 未定义: 具体的文件处理算法、存储策略
```

------------------------------

### S: 环境配置

```
S-1: Python环境要求
├── S-1.1: Python版本 - Python 3.10+（强制）
├── S-1.2: 运行环境 - 支持asyncio异步并发处理
├── S-1.3: 依赖管理 - 使用requirements.txt管理依赖版本
└── S-1.4: 资源要求 - 内存768MB+，CPU 1核+

S-2: 依赖服务要求
├── S-2.1: 必需服务 - routing_agent, llm_handler_agent, database_agent, frontend_service_agent
├── S-2.2: 外部服务 - MinIO对象存储、数据库服务
├── S-2.3: 网络要求 - 稳定的网络连接，支持HTTPS
└── S-2.4: 安全要求 - SSL/TLS加密，安全认证机制

S-3: 配置文件要求
├── S-3.1: 配置来源 - 通过routing_agent的global_config获取
├── S-3.2: 环境变量 - 最小化环境变量使用，优先使用配置中心
├── S-3.3: 热更新支持 - 支持配置实时更新，无需重启服务
└── S-3.4: 默认值机制 - 所有配置项必须提供默认值和回滚策略

⚠️ 未定义: 具体的环境配置参数、部署要求
```

------------------------------

### T: 运行要求

```
T-1: 系统运行要求
├── T-1.1: 操作系统 - 支持Linux、Windows、macOS
├── T-1.2: 硬件要求 - 内存768MB+，CPU 1核+，存储空间1GB+
├── T-1.3: 网络要求 - 稳定的互联网连接，支持HTTPS协议
└── T-1.4: 并发要求 - 支持多用户并发处理

T-2: 性能要求
├── T-2.1: 响应时间 - 文件解析<30秒，对话响应<5秒
├── T-2.2: 成功率 - 简历解析成功率>92%，数据提取准确率>85%
├── T-2.3: 并发处理 - 支持同时处理多个用户的简历解析请求
└── T-2.4: 资源使用 - CPU使用率<80%，内存使用率<70%

T-3: 可用性要求
├── T-3.1: 服务可用性 - 99.5%可用性承诺
├── T-3.2: 故障恢复 - 自动故障检测和恢复机制
├── T-3.3: 监控告警 - 实时监控和异常告警
└── T-3.4: 备份恢复 - 数据备份和灾难恢复机制

⚠️ 未定义: 具体的性能指标、监控策略
```

------------------------------

### U: 版本依赖

```
U-1: Python依赖版本
├── U-1.1: Python版本 - Python 3.10+（强制要求）
├── U-1.2: Pydantic版本 - Pydantic V2（必须使用V2语法）
├── U-1.3: AsyncIO版本 - 使用Python标准库asyncio
└── U-1.4: 其他依赖 - 参考requirements.txt中的具体版本要求

U-2: 模块依赖版本
├── U-2.1: global_schemas - 统一的数据模型定义
├── U-2.2: routing_agent - 核心路由和配置管理
├── U-2.3: llm_handler_agent - LLM调用服务
└── U-2.4: database_agent - 数据存储服务

U-3: 外部服务依赖
├── U-3.1: MinIO - 对象存储服务
├── U-3.2: 数据库 - 用户数据存储
├── U-3.3: LLM服务 - GPT-4o模型服务
└── U-3.4: 网络服务 - HTTPS、WebSocket支持

⚠️ 未定义: 具体的版本兼容性矩阵、升级策略
```

------------------------------

### V: 模块限制

```
V-1: 功能边界限制
├── V-1.1: 职责限制 - 仅负责简历解析和用户画像构建，不涉及MBTI分析、标签生成等
├── V-1.2: 数据范围限制 - 仅处理26个标准字段，不扩展其他用户信息
├── V-1.3: 流程限制 - 仅处理5步骤中的简历上传和信息补充环节
└── V-1.4: 时间限制 - 单次处理时间不超过5分钟，超时自动终止

V-2: 技术实现限制
├── V-2.1: 无状态限制 - 模块本身不保存任何状态信息
├── V-2.2: 被动调用限制 - 仅响应routing_agent调度，不主动运行
├── V-2.3: 通信限制 - 仅通过routing_agent与其他模块通信
└── V-2.4: 配置限制 - 仅通过global_config获取配置，不使用本地配置

V-3: 安全限制
├── V-3.1: 权限限制 - 最小权限原则，仅访问必要的资源
├── V-3.2: 数据限制 - 不得存储敏感信息，必须进行数据脱敏
├── V-3.3: 网络限制 - 不得直接访问外部API，必须通过routing_agent
└── V-3.4: 日志限制 - 不得在日志中记录完整的个人敏感信息

⚠️ 未定义: 具体的限制实施机制、违规检测
```

------------------------------

### W: 测试策略

```
W-1: 测试环境准备
├── W-1.1: 测试文件准备 - 使用utility_tools/resume/下的真实简历文件
├── W-1.2: 支持格式测试 - PDF、DOCX、DOC格式的完整测试
├── W-1.3: 推荐测试文件 - CESARIO.pdf, FINALMALIMBAN_CV_2024.docx
└── W-1.4: 模块接入说明 - resume_agent是被动调用的业务模块，不包含启动逻辑和测试代码

W-2: 测试类型规范
├── W-2.1: 生产级测试 - 使用真实的简历文件和对话流程，禁用Mock机制
├── W-2.2: 完整流程测试 - 测试文件解析→对话补充→画像构建的完整链路
├── W-2.3: 真实集成测试 - 使用真实的routing_agent、llm_handler_agent、database_agent集成
└── W-2.4: 性能测试 - 测试并发处理能力和响应时间

W-3: 验证标准
├── W-3.1: 文件解析验证 - 检查提取文本的完整性和关键信息覆盖度
├── W-3.2: AI提取验证 - 验证LLM提取的字段数据准确性和逻辑一致性
├── W-3.3: 对话流程验证 - 测试问题生成、回答检测、质量评估的完整循环
└── W-3.4: 数据库兼容验证 - 确保输出数据与database_agent存储格式完全匹配

⚠️ 未定义: 具体的测试用例、验证标准
```

------------------------------

### X: 验收机制

```
X-1: 功能验收标准
├── X-1.1: 文件处理验收 - 支持的文件格式解析成功率>95%
├── X-1.2: 信息提取验收 - 26字段提取完整度>90%，准确率>85%
├── X-1.3: 对话补充验收 - 多轮对话成功完成率>90%
└── X-1.4: 数据质量验收 - 最终用户画像完整度>90%

X-2: 性能验收标准
├── X-2.1: 响应时间验收 - 文件解析<30秒，对话响应<5秒
├── X-2.2: 并发处理验收 - 支持至少10个并发用户
├── X-2.3: 资源使用验收 - CPU使用率<80%，内存使用率<70%
└── X-2.4: 错误率验收 - 系统错误率<5%，用户可恢复错误率<10%

X-3: 集成验收标准
├── X-3.1: 模块协作验收 - 与其他模块的接口调用成功率>99%
├── X-3.2: 数据一致性验收 - 输出数据格式与database_agent完全匹配
├── X-3.3: 配置管理验收 - 配置热更新功能正常，回滚机制有效
└── X-3.4: 异常处理验收 - 异常情况下的错误处理和恢复机制有效

⚠️ 未定义: 具体的验收测试流程、验收标准细则
```

------------------------------

### Y: 部署策略

```
Y-1: 部署环境要求
├── Y-1.1: 环境要求 - Python 3.10+，内存768MB+，CPU 1核+
├── Y-1.2: 依赖服务 - routing_agent, llm_handler_agent, database_agent, frontend_service_agent
├── Y-1.3: 外部服务 - MinIO对象存储、数据库服务、LLM服务
└── Y-1.4: 网络要求 - 稳定的网络连接，支持HTTPS和WebSocket

Y-2: 部署流程
├── Y-2.1: 环境准备 - 安装Python环境和依赖包
├── Y-2.2: 配置部署 - 配置routing_agent和global_config
├── Y-2.3: 服务启动 - 通过boot/launcher.py启动整个系统
└── Y-2.4: 健康检查 - 验证模块正常运行和接口可用性

Y-3: 监控指标
├── Y-3.1: 业务指标 - 简历解析成功率>92%，响应时间<8秒，26字段完整度>85%
├── Y-3.2: 系统指标 - CPU使用率、内存使用率、网络延迟
├── Y-3.3: 错误指标 - 错误率、异常次数、恢复时间
└── Y-3.4: 用户指标 - 用户满意度、处理成功率、重试次数

⚠️ 未定义: 具体的部署脚本、监控配置
```

------------------------------

### Z: 未来规划

```
Z-1: 功能扩展规划
├── Z-1.1: 多语言支持 - 支持中文、英文、菲律宾语等多语言简历解析
├── Z-1.2: 智能推荐 - 基于简历内容智能推荐职位和技能提升建议
├── Z-1.3: 批量处理 - 支持批量上传和处理多份简历
└── Z-1.4: 高级分析 - 提供更深入的简历质量分析和改进建议

Z-2: 技术优化规划
├── Z-2.1: 性能优化 - 提升文件解析速度和AI提取效率
├── Z-2.2: 准确率提升 - 优化AI模型和提取算法，提高信息提取准确率
├── Z-2.3: 用户体验优化 - 改进对话流程和用户界面交互
└── Z-2.4: 系统稳定性 - 增强错误处理和恢复机制

Z-3: 集成扩展规划
├── Z-3.1: 第三方集成 - 集成LinkedIn、Indeed等招聘平台
├── Z-3.2: API开放 - 提供标准化API供第三方系统调用
├── Z-3.3: 数据分析 - 提供简历数据的统计分析和趋势报告
└── Z-3.4: 移动端支持 - 支持移动端应用的简历上传和处理

⚠️ 未定义: 具体的实施计划、优先级排序
```

---

## 文档重构完成说明

本结构化文档骨架已完成对原始readme.md的全面重构，覆盖了所有信息价值内容：

✅ **已完成结构化重建**：
- A-Z共26个主要分类，涵盖开发边界、系统架构、输入输出、配置机制、模型路径、调用方式、用户流程、对话流程、意图识别、接口结构、状态管理、日志异常、UI组件、事件响应、错误处理、WebSocket集成、LLM集成、上传机制、环境配置、运行要求、版本依赖、模块限制、测试策略、验收机制、部署策略、未来规划等
- 每个分类下细分为多个子项，采用树状编号体系
- 保留所有原文档中的重要信息，包括未定义项标记
- 严格遵循要求的格式：标题+代码块+分隔符

✅ **信息完整性保证**：
- 未遗漏任何原文档中的功能特性、技术约束、流程说明
- 保持了所有专业术语和关键概念的准确性
- 维护了模块间依赖关系和协作机制的完整描述
- 标注了所有未定义项，避免信息遗漏

该结构化骨架为Step 2的内容补全提供了稳定、完整、准确的基础框架。
