# boot 模块结构化文档骨架

## A: 开发边界与职责说明

### A-1: 模块基本定义

```
boot模块是Career Bot系统的启动装配中心，严格遵循Composition Root（装配根）和单一职责原则（SRP）。本模块负责系统的"干净启动"，即仅进行组件装配、依赖注入和启动编排，不包含任何业务逻辑和测试代码。作为系统的"装配工厂"，boot模块确保main.py保持极简（≤50行），仅负责CLI参数解析和装配器调用，所有复杂的装配逻辑都封装在专业的装配器中。
```

------------------------------

### A-2: 核心功能特性

```
├── A-2.1: 装配根规范
│   ├── A-2.1.1: main.py - ≤50行，仅做CLI解析 + 调用装配器方法 + 返回退出码
│   ├── A-2.1.2: launcher.py - ≤150行，专注装配编排，不写具体依赖实现
│   ├── A-2.1.3: connectors/ - 外部依赖连接器分层，便于替换和打桩
│   └── A-2.1.4: registry - Agent注册表驱动的模块管理
├── A-2.2: 单一职责分工
│   ├── A-2.2.1: Main（主启动文件） - 只做CLI参数解析、启动器调用、退出码返回，禁止任何业务规则、装配逻辑、外部I/O
│   ├── A-2.2.2: Launcher（启动编排） - 只实现模块装配、依赖注入、启动编排逻辑，禁止写业务决策、具体连接实现
│   ├── A-2.2.3: Connectors（连接器） - 仅供外部服务连接和健康检查，不得跨模块导出，禁止出现业务逻辑
│   └── A-2.2.4: 拆分触发 - 当单文件同时承担两类以上变更原因或超过200行时必须拆分到对应层
└── A-2.3: 两阶段启动机制
    ├── A-2.3.1: env_check() - 必跑阶段：验证环境变量、配置文件完整性
    └── A-2.3.2: deps_check() - 可跳过阶段：外部依赖连通性检查，支持降级模式
```

------------------------------

### A-3: 职责边界约束

```
├── A-3.1: 工作区限制
│   └── 生成和修改仅允许发生在boot/内，禁止创建、移动、重命名、删除boot/之外的任何文件/目录
├── A-3.2: 主入口约定
│   └── 模块主入口文件名与boot同名（main.py为全局入口，launcher.py为boot模块核心），非主入口的新增文件必须归类为Connector或Config
├── A-3.3: 粒度限制
│   └── 单次变更仅允许操作一个文件，若超过300行，自动截断并停止，等待下一次续写
└── A-3.4: 结构稳定性
    └── 禁止因实现便利而新建"公共"目录，禁止在模块间互放工具文件，不得私自抽公共层
```

------------------------------

## B: 系统架构与模块定义

### B-1: 架构设计原则

```
├── B-1.1: 装配根规范
│   ├── B-1.1.1: main.py - ≤50行，仅做CLI解析 + 调用装配器方法 + 返回退出码
│   ├── B-1.1.2: launcher.py - ≤150行，专注装配编排，不写具体依赖实现
│   ├── B-1.1.3: connectors/ - 外部依赖连接器分层，便于替换和打桩
│   └── B-1.1.4: registry - Agent注册表驱动的模块管理
└── B-1.2: 单一职责分工
    ├── B-1.2.1: main.py - CLI入口（参数解析 + 调用装配器）
    ├── B-1.2.2: boot/launcher.py - 装配编排（组件装配 + 启动管理）
    ├── B-1.2.3: connectors/ - 连接器分层（mongo, redis, minio, openai, chroma）
    ├── B-1.2.4: applications/ - Agent注册表（__registry__.py驱动的Agent声明）
    └── B-1.2.5: utility_tools/global_test/ - 测试驱动（pytest, CLI测试脚本）
```

------------------------------

### B-2: 两阶段启动机制

```
├── B-2.1: env_check() - 必跑阶段
│   ├── B-2.1.1: 验证环境变量完整性
│   ├── B-2.1.2: 配置文件存在性检查
│   ├── B-2.1.3: 文件权限检查
│   └── B-2.1.4: 端口可用性检查
└── B-2.2: deps_check() - 可跳过阶段
    ├── B-2.2.1: 外部依赖连通性检查
    ├── B-2.2.2: 硬依赖检查（必需服务）
    ├── B-2.2.3: 软依赖检查（可降级服务）
    └── B-2.2.4: 支持降级模式处理
```

------------------------------

### B-3: launcher.py装配器设计

```
├── B-3.1: 装配器职责规范
│   ├── B-3.1.1: 代码行数限制 - ≤150行（含注释和空行）
│   ├── B-3.1.2: 方法长度限制 - 单方法≤25行
│   ├── B-3.1.3: 类设计 - 单一Launcher类，禁止继承和复杂设计模式
│   └── B-3.1.4: 依赖导入 - 外部依赖导入≤10个，避免重型依赖
├── B-3.2: 方法职责分离
│   ├── B-3.2.1: start()方法 - 主启动入口，≤25行，仅调用子方法
│   ├── B-3.2.2: env_check()方法 - 环境检查，≤25行，验证基础环境
│   ├── B-3.2.3: deps_check()方法 - 依赖检查，≤25行，验证外部依赖
│   ├── B-3.2.4: assemble_agents()方法 - Agent装配，≤25行，基于注册表装配，需拆分为多个子方法
│   ├── B-3.2.5: health()方法 - 健康检查，≤25行，返回系统状态
│   └── B-3.2.6: shutdown()方法 - 优雅关闭，≤25行，清理资源
└── B-3.3: 启动阶段设计
    ├── B-3.3.1: 阶段一：环境验证 - 验证Python版本、环境变量、基础配置文件存在性
    ├── B-3.3.2: 阶段二：依赖检查 - 检查外部依赖服务可用性，支持skip_non_critical参数
    ├── B-3.3.3: 阶段三：注册表验证 - 验证applications/__registry__.py的完整性
    ├── B-3.3.4: 阶段四：模块装配 - 按照三层架构依次装配模块，支持同层并发装配
    └── B-3.3.5: 阶段五：服务就绪 - 所有模块启动完成后，系统进入就绪状态
```

------------------------------

## C: 输入输出规范、配置机制、模型路径、调用方式

### C-1: CLI输入参数规范

```
├── C-1.1: 环境检查参数
│   └── --env-check: bool, 默认False, 执行环境检查
├── C-1.2: 健康检查参数
│   └── --health: bool, 默认False, 执行健康检查
├── C-1.3: 启动参数
│   ├── --start: bool, 默认False, 启动系统
│   ├── --production: bool, 默认False, 生产模式开关
│   └── --env-file: str, 可选, 指定配置文件路径
└── C-1.4: 默认行为
    └── 无参数时等价于--start
```

------------------------------

### C-2: 输出返回码规范

```
├── C-2.1: 成功返回码
│   └── 0: 操作成功完成
├── C-2.2: 失败返回码
│   ├── 1: 操作失败或硬依赖不可用
│   └── 2: 部分失败但可继续（软依赖失败但硬依赖正常，系统可降级启动）
└── C-2.3: Launcher类方法契约
    ├── env_check() → int: 环境检查，返回0|1
    ├── deps_check(skip_non_critical: bool = True) → int: 依赖检查，返回0|1|2
    ├── start(production: bool = False, env_file: str = None) → int: 启动系统
    ├── health() → int: 健康检查
    └── shutdown() → int: 优雅关闭
```

------------------------------

### C-3: 配置机制

```
├── C-3.1: 配置文件结构
│   ├── C-3.1.1: .env文件 - 项目根目录下的主配置文件
│   ├── C-3.1.2: 数据库配置 - MONGODB_CONNECTION_STRING、MONGODB_DATABASE_NAME等
│   ├── C-3.1.3: Redis配置 - CACHE_URL、REDIS_MAX_CONNECTIONS、SESSION_TTL
│   ├── C-3.1.4: OpenAI配置 - OPENAI_API_KEY、OPENAI_BASE_URL、OPENAI_DEFAULT_MODEL
│   ├── C-3.1.5: MinIO配置 - MINIO_ENDPOINT、MINIO_ACCESS_KEY等
│   ├── C-3.1.6: ChromaDB配置 - CHROMADB_HOST、CHROMADB_PORT等
│   ├── C-3.1.7: 服务端口配置 - ENTRY_AGENT_PORT、ROUTING_AGENT_PORT
│   ├── C-3.1.8: 安全配置 - JWT_SECRET_KEY、PASSWORD_HASH_ALGORITHM等
│   └── C-3.1.9: 邮件服务配置 - SMTP_HOST、SMTP_PORT、SUPPORT_EMAIL
├── C-3.2: 配置唯一来源
│   └── 配置仅可经由routing_agent的config_manager服务读取，禁止本地硬编码可变配置
├── C-3.3: 热更新与回滚
│   └── 配置键名/层级不可私改，新增键必须提供默认值、回滚策略
└── C-3.4: 配置来源优先级
    └── .env文件 > 环境变量 > 默认值
```

------------------------------

### C-4: 模型路径与数据模型

```
├── C-4.1: 模型唯一来源
│   └── 所有数据模型/Schema一律从global_schemas引入，禁止在模块内新增/复制业务模型或DTO
├── C-4.2: 接口契约
│   └── 本模块README必须提供最小可执行契约（接口签名或伪码），仅声明入参/出参/错误码，不提供实现样例
└── C-4.3: 版本与兼容
    └── 任何新增/变更字段必须在README标注语义、默认值、兼容策略，并同步更新global_schemas对应版本
```

------------------------------

### C-5: 调用方式规范

```
├── C-5.1: 标准启动命令
│   ├── C-5.1.1: 环境检查 - python main.py --env-check
│   ├── C-5.1.2: 健康检查 - python main.py --health
│   ├── C-5.1.3: 启动系统 - python main.py --start 或 python main.py（默认）
│   ├── C-5.1.4: 生产模式启动 - python main.py --start --production
│   └── C-5.1.5: 指定配置文件启动 - python main.py --start --env-file ./custom.env
└── C-5.2: 启动流程编排
    ├── C-5.2.1: main.py --start
    ├── C-5.2.2: env_check() - 必跑：验证.env完整性
    ├── C-5.2.3: deps_check() - 可跳过：外部服务检查
    ├── C-5.2.4: connectors装配 - 创建连接器实例
    ├── C-5.2.5: agent注册装配 - 基于registry加载Agent
    ├── C-5.2.6: 服务启动 - 启动entry_agent和routing_agent
    ├── C-5.2.7: 健康验证 - 最终健康检查
    └── C-5.2.8: 系统就绪 - 输出启动成功信息
```

------------------------------

## D: 用户流程、对话流程、意图识别机制

### D-1: 启动用户流程

```
⚠️ 未定义 - boot模块作为系统启动装配中心，不直接处理用户对话流程和意图识别，这些功能属于业务Agent职责范围
```

------------------------------

### D-2: 对话流程机制

```
⚠️ 未定义 - boot模块不涉及对话流程处理，仅负责装配启动应用层的对话处理模块
```

------------------------------

### D-3: 意图识别机制

```
⚠️ 未定义 - boot模块不包含意图识别功能，仅负责启动装配相关的意图识别Agent模块
```

------------------------------

## E: 接口结构、状态管理、日志与异常策略

### E-1: 接口结构设计

```
├── E-1.1: Launcher类接口规范
│   ├── E-1.1.1: env_check() → int - 环境检查接口
│   ├── E-1.1.2: deps_check(skip_non_critical: bool = True) → int - 依赖检查接口
│   ├── E-1.1.3: start(production: bool = False, env_file: str = None) → int - 启动接口
│   ├── E-1.1.4: health() → int - 健康检查接口
│   └── E-1.1.5: shutdown() → int - 优雅关闭接口
├── E-1.2: 连接器接口规范
│   ├── E-1.2.1: create_connection(config: Dict) - 创建连接实例
│   ├── E-1.2.2: health_check() → bool - 连接健康检查
│   └── E-1.2.3: close_connection() - 优雅关闭连接
└── E-1.3: 连接器工厂接口
    ├── E-1.3.1: create_all_connectors(env_config: Dict) → Dict[str, Any] - 创建所有连接器实例
    └── E-1.3.2: health_check_all(connectors: Dict) → Dict[str, bool] - 批量健康检查
```

------------------------------

### E-2: 状态管理机制

```
├── E-2.1: 模块状态存取
│   └── 模块不得直接访问持久化（DB/Cache/FS），必须通过指定Connector间接访问外部服务
├── E-2.2: 副作用隔离
│   └── 任何网络/系统I/O仅可写在Connector，Main/Launcher出现I/O视为违规
├── E-2.3: 可重复执行
│   └── 生成的任意函数需满足幂等/可重放要求（同输入不应产生额外副作用）
└── E-2.4: 系统状态跟踪
    ├── E-2.4.1: 启动状态跟踪 - 环境检查 → 依赖检查 → 装配 → 启动 → 就绪
    └── E-2.4.2: 连接器状态管理 - 连接建立、健康监控、故障恢复、优雅关闭
```

------------------------------

### E-3: 日志策略

```
├── E-3.1: 日志必填字段
│   └── request_id、module_name、operation、duration_ms、success、retry_count
├── E-3.2: 敏感信息保护
│   └── 日志/错误信息不得包含密钥、令牌、身份证件、邮箱全量、手机号全量等，必要时脱敏
├── E-3.3: 核心指标
│   ├── E-3.3.1: boot_startup_duration_ms - 启动耗时
│   ├── E-3.3.2: boot_health_check_success_rate - 健康检查成功率
│   └── E-3.3.3: boot_dependency_availability - 依赖可用率
└── E-3.4: 指标暴露要求
    └── 至少暴露调用次数、成功率、时延分布三类指标，指标名在README固化，禁止私改
```

------------------------------

### E-4: 异常策略

```
├── E-4.1: 错误码规范
│   ├── E-4.1.1: 错误码命名 - 采用{DOMAIN}/{REASON}命名（如：AUTH/TIMEOUT、IO/UNAVAILABLE）
│   └── E-4.1.2: 错误码全集
│       ├── BOOT/ENV_MISSING - 环境变量缺失
│       ├── BOOT/CONFIG_INVALID - 配置格式错误
│       ├── BOOT/DEPS_UNAVAILABLE - 硬依赖不可用
│       └── BOOT/TIMEOUT - 启动超时
├── E-4.2: 异常传播规则
│   └── 只允许抛出仓库标准异常基类及其子类，不得抛裸异常，错误信息需面向调用方而非实现细节
├── E-4.3: 失败回退策略
│   └── 失败时必须返回可操作指令（如flow指令/重试建议/联系渠道），不得要求调用方自行猜测
└── E-4.4: 故障恢复机制
    ├── E-4.4.1: 连接断开重试
    ├── E-4.4.2: 超时处理
    ├── E-4.4.3: 限流保护
    └── E-4.4.4: 降级模式
```

------------------------------

## F: UI组件结构、事件响应、错误处理机制

### F-1: UI组件结构

```
⚠️ 未定义 - boot模块是后端启动装配模块，不包含UI组件结构，UI相关功能由frontend_service_agent负责
```

------------------------------

### F-2: 事件响应机制

```
⚠️ 未定义 - boot模块不处理用户界面事件响应，仅负责系统启动过程中的内部事件编排
```

------------------------------

### F-3: 错误处理机制

```
boot模块错误处理机制完全基于返回码和异常传播：
├── F-3.1: 启动阶段错误处理
│   ├── F-3.1.1: 环境检查失败 - 立即返回错误码1，输出明确错误信息
│   ├── F-3.1.2: 硬依赖检查失败 - 返回错误码1，系统无法启动
│   └── F-3.1.3: 软依赖检查失败 - 返回错误码2，系统可降级启动
├── F-3.2: 连接器错误处理
│   ├── F-3.2.1: 连接创建失败 - 抛出标准异常，包含重试建议
│   ├── F-3.2.2: 健康检查失败 - 记录日志，支持降级模式
│   └── F-3.2.3: 连接断开处理 - 自动重连机制，记录故障日志
└── F-3.3: Agent装配错误处理
    ├── F-3.3.1: 注册表验证失败 - 终止装配，返回配置错误信息
    ├── F-3.3.2: 必需Agent装配失败 - 终止启动，返回具体失败信息
    └── F-3.3.3: 可选Agent装配失败 - 记录警告，继续启动流程
```

------------------------------

## G: WebSocket/LLM/上传机制等集成接口

### G-1: WebSocket集成接口

```
⚠️ 未定义 - boot模块不直接实现WebSocket接口，仅负责启动装配相关的WebSocket服务Agent
```

------------------------------

### G-2: LLM集成接口

```
├── G-2.1: OpenAI连接器集成
│   ├── G-2.1.1: openai_connector.py - OpenAI API连接器
│   ├── G-2.1.2: 连接管理 - 封装OpenAI API调用、模型选择、Prompt管理
│   ├── G-2.1.3: 限流控制 - 支持API调用限流和错误重试机制
│   └── G-2.1.4: 配置管理 - OPENAI_API_KEY、OPENAI_BASE_URL、OPENAI_DEFAULT_MODEL配置
└── G-2.2: LLM服务装配
    ├── G-2.2.1: 连接器创建 - 通过连接器工厂创建OpenAI连接器实例
    ├── G-2.2.2: 健康检查 - 验证OpenAI API连通性和访问权限
    └── G-2.2.3: 依赖注入 - 将LLM连接器注入到需要的业务Agent中
```

------------------------------

### G-3: 上传机制集成接口

```
├── G-3.1: MinIO连接器集成
│   ├── G-3.1.1: minio_connector.py - MinIO对象存储连接器
│   ├── G-3.1.2: 连接管理 - 封装对象存储连接、文件上传下载、存储桶管理
│   ├── G-3.1.3: 访问控制 - 提供安全的文件存储服务和访问权限控制
│   └── G-3.1.4: 配置管理 - MINIO_ENDPOINT、MINIO_ACCESS_KEY、MINIO_SECRET_KEY等配置
└── G-3.2: 文件存储装配
    ├── G-3.2.1: 连接器创建 - 通过连接器工厂创建MinIO连接器实例
    ├── G-3.2.2: 健康检查 - 验证MinIO服务连通性和访问权限
    ├── G-3.2.3: 降级处理 - MinIO不可用时使用本地文件系统降级
    └── G-3.2.4: 依赖注入 - 将存储连接器注入到需要的业务Agent中
```

------------------------------

## H: 环境配置、运行要求、版本依赖、模块限制

### H-1: 环境配置要求

```
├── H-1.1: Python环境要求
│   ├── H-1.1.1: Python版本 - Python 3.8+
│   ├── H-1.1.2: 异步支持 - 支持async/await语法
│   └── H-1.1.3: 包管理 - 使用pip进行依赖管理
├── H-1.2: 操作系统要求
│   ├── H-1.2.1: 跨平台支持 - Windows、Linux、macOS
│   ├── H-1.2.2: 文件权限 - 需要.env文件和日志目录的读写权限
│   └── H-1.2.3: 网络要求 - 需要访问外部API和数据库服务
└── H-1.3: 基础设施要求
    ├── H-1.3.1: 硬依赖服务 - MongoDB、Redis、OpenAI API必须可用
    ├── H-1.3.2: 软依赖服务 - MinIO、ChromaDB可选，支持降级模式
    └── H-1.3.3: 端口要求 - ENTRY_AGENT_PORT、ROUTING_AGENT_PORT端口可用
```

------------------------------

### H-2: 运行要求

```
├── H-2.1: 内存要求
│   └── ⚠️ 未定义 - 具体内存要求需要根据实际负载和Agent数量确定
├── H-2.2: CPU要求
│   └── ⚠️ 未定义 - CPU要求取决于并发装配的Agent数量和复杂度
├── H-2.3: 存储要求
│   └── ⚠️ 未定义 - 存储空间要求需要考虑日志文件和临时文件大小
└── H-2.4: 网络要求
    ├── H-2.4.1: 外部API访问 - 稳定的互联网连接用于访问OpenAI API
    ├── H-2.4.2: 数据库连接 - 稳定的网络连接用于访问MongoDB和Redis
    └── H-2.4.3: 内网服务访问 - 访问MinIO和ChromaDB服务的网络连接
```

------------------------------

### H-3: 版本依赖管理

```
├── H-3.1: 依赖管理文件
│   └── requirements.txt - 统一管理所有Python包版本依赖
├── H-3.2: 核心依赖
│   ├── H-3.2.1: asyncio - Python内置异步库
│   ├── H-3.2.2: argparse - Python内置命令行解析库
│   ├── H-3.2.3: logging - Python内置日志库
│   └── H-3.2.4: os, sys - Python内置系统库
├── H-3.3: 外部依赖
│   ├── H-3.3.1: motor - MongoDB异步驱动
│   ├── H-3.3.2: redis - Redis客户端库
│   ├── H-3.3.3: minio - MinIO客户端库
│   ├── H-3.3.4: openai - OpenAI API客户端库
│   └── H-3.3.5: chromadb - ChromaDB客户端库
└── H-3.4: 版本锁定策略
    └── ⚠️ 未定义 - 具体版本号和兼容性策略需要在requirements.txt中明确
```

------------------------------

### H-4: 模块限制

```
├── H-4.1: 代码行数限制
│   ├── H-4.1.1: main.py - ≤50行
│   ├── H-4.1.2: launcher.py - ≤150行
│   ├── H-4.1.3: 单方法 - ≤25行
│   └── H-4.1.4: 单次变更 - ≤300行，超过自动截断
├── H-4.2: 职责边界限制
│   ├── H-4.2.1: 工作区限制 - 仅允许在boot/目录内操作
│   ├── H-4.2.2: 业务逻辑禁止 - 不得包含任何业务逻辑
│   ├── H-4.2.3: 测试逻辑禁止 - 所有测试逻辑已迁移至utility_tools/global_test/
│   └── H-4.2.4: 直接I/O禁止 - Main/Launcher不得包含直接I/O操作
├── H-4.3: 并发限制
│   ├── H-4.3.1: 并发原语 - 仅允许使用async/await、事件循环
│   ├── H-4.3.2: 线程池禁止 - 禁止线程池/进程池，除非在Connector层且README明示风险
│   └── H-4.3.3: 超时控制 - 超时/重试参数必须经routing_agent的config_manager服务注入
└── H-4.4: 安全限制
    ├── H-4.4.1: 秘钥管理 - 不得在代码/README/示例中出现任何真实秘钥
    ├── H-4.4.2: 输入校验 - 所有外部输入必须显式校验
    └── H-4.4.3: 权限最小化 - 仅请求所需最小范围的权限与数据字段
```

------------------------------

## I: 测试策略、验收机制、部署策略、未来规划

### I-1: 测试策略

```
├── I-1.1: 测试分离原则
│   ├── I-1.1.1: 测试出仓设计 - boot模块严格禁止包含任何测试逻辑
│   ├── I-1.1.2: 统一测试目录 - 所有测试功能已迁移至utility_tools/global_test/
│   ├── I-1.1.3: 后端测试 - utility_tools/global_test/back_end/包含Agent功能测试、端到端流程测试、性能压力测试
│   └── I-1.1.4: 前端测试 - utility_tools/global_test/front_end/包含前端界面测试、前后端集成测试
├── I-1.2: 测试调用方式
│   ├── I-1.2.1: CLI测试 - python utility_tools/global_test/back_end/test_agents.py --agent resume_agent --file path/to/resume.pdf
│   └── I-1.2.2: 自动化测试 - python -m pytest utility_tools/global_test/back_end/ 和 python -m pytest utility_tools/global_test/front_end/
├── I-1.3: 连接器测试支持
│   ├── I-1.3.1: Mock替换 - 连接器支持mock替换，便于单元测试
│   └── I-1.3.2: 集成测试 - 支持真实依赖的集成测试
└── I-1.4: 最小用例要求
    ├── I-1.4.1: 冒烟测试 - 验证基本启动流程
    └── I-1.4.2: 失败路径测试 - 验证各种失败场景的处理
```

------------------------------

### I-2: 验收机制

```
├── I-2.1: 代码规范验收
│   ├── I-2.1.1: main.py ≤ 50行
│   ├── I-2.1.2: boot/launcher.py ≤ 150行
│   ├── I-2.1.3: connectors/分层设计完成
│   └── I-2.1.4: 测试逻辑完全迁移到utility_tools/global_test/
├── I-2.2: 功能验收标准
│   ├── I-2.2.1: python main.py --env-check 可用
│   ├── I-2.2.2: python main.py --health 可用
│   ├── I-2.2.3: python main.py --start 可用
│   ├── I-2.2.4: 无测试逻辑混在生产入口
│   ├── I-2.2.5: 任意外部依赖不可用时有清晰错误提示
│   └── I-2.2.6: 新增/删除Agent只需修改注册表
└── I-2.3: 验收门槛
    └── 生成变更必须先通过本模块用例再提交，未达门槛禁止继续生成下一文件
```

------------------------------

### I-3: 部署策略

```
⚠️ 未定义 - 具体部署策略包括容器化部署、多环境配置、负载均衡等需要进一步明确
```

------------------------------

### I-4: 未来规划

```
⚠️ 未定义 - 未来规划包括性能优化、功能扩展、架构演进等需要根据业务发展进行规划
```

------------------------------

## J: 未定义项、待补要点、黑名单、禁用规则

### J-1: 未定义项清单

```
├── J-1.1: AgentFactory.create_agent()接口
│   ├── 影响面：所有Agent装配逻辑
│   └── 选项：A)工厂类静态方法 B)注册表驱动装配 C)依赖注入容器
├── J-1.2: ConnectorFactory具体接口
│   ├── 影响面：外部依赖连接管理
│   └── 选项：A)统一工厂接口 B)独立连接器管理 C)连接池共享机制
├── J-1.3: global_schemas模块接口
│   ├── 影响面：数据模型获取方式
│   └── 选项：A)直接导入 B)动态加载 C)版本化Schema管理
├── J-1.4: applications/__registry__.py完整结构
│   ├── 影响面：Agent注册和启动序列
│   └── 选项：A)Python字典 B)YAML配置 C)数据库配置
├── J-1.5: 具体版本号和兼容性策略
│   ├── 影响面：依赖管理和系统稳定性
│   └── 选项：A)固定版本锁定 B)语义版本范围 C)滚动更新策略
├── J-1.6: 系统资源要求
│   ├── 影响面：部署和运维规划
│   └── 选项：A)基于负载测试确定 B)预估配置 C)动态扩展机制
├── J-1.7: 部署策略细节
│   ├── 影响面：生产环境部署和运维
│   └── 选项：A)容器化部署 B)传统部署 C)云原生部署
└── J-1.8: 未来规划路线图
    ├── 影响面：系统演进和技术选型
    └── 选项：A)功能驱动演进 B)架构优化优先 C)性能提升优先
```

------------------------------

### J-2: 待补要点

```
├── J-2.1: 待补键名/字段
│   ├── J-2.1.1: AgentFactory接口定义（含建议默认值/取值域）
│   ├── J-2.1.2: ConnectorFactory具体方法签名
│   ├── J-2.1.3: global_schemas访问接口
│   └── J-2.1.4: __registry__.py详细结构和字段
├── J-2.2: 影响面分析
│   ├── J-2.2.1: 调用方 - 所有使用装配功能的模块
│   ├── J-2.2.2: 下游模块 - 所有需要依赖注入的Agent模块
│   └── J-2.2.3: 运行时风险 - 装配失败、连接器创建失败、Schema不兼容
└── J-2.3: 最小决策集
    └── 给出2～3个可选项，偏保守实现，确保系统稳定性和可维护性
```

------------------------------

### J-3: 关键词黑名单

```
├── J-3.1: 禁止本地业务模型定义
│   └── "class .*Model", "data class .*", "interface .*DTO"
├── J-3.2: 禁止硬编码配置
│   └── "API_KEY=", "timeout\\s*=\\s*\\d+", "retry\\s*=\\s*\\d+"
├── J-3.3: 禁止跨层I/O
│   └── 在Main/Launcher中出现"http", "db", "sql", "open(", "requests", "fetch"
├── J-3.4: 禁止并发越界
│   └── "Thread", "Process", "fork", "Pool"
└── J-3.5: 禁止未脱敏日志
    └── "print(", "console.log(", "logging.info(f\".*password|token|secret"
```

------------------------------

### J-4: 禁用规则

```
├── J-4.1: 文件操作禁用
│   ├── J-4.1.1: 禁止创建、移动、重命名、删除boot/之外的任何文件/目录
│   ├── J-4.1.2: 禁止新增"公共"目录
│   └── J-4.1.3: 禁止在模块间互放工具文件
├── J-4.2: 代码结构禁用
│   ├── J-4.2.1: 禁止在main.py/launcher.py中包含业务逻辑
│   ├── J-4.2.2: 禁止在main.py/launcher.py中包含测试逻辑
│   ├── J-4.2.3: 禁止在Main/Launcher中出现直接I/O操作
│   └── J-4.2.4: 禁止Connector跨模块导出
├── J-4.3: 安全规则禁用
│   ├── J-4.3.1: 禁止在代码/README/示例中出现真实秘钥
│   ├── J-4.3.2: 禁止提升权限
│   └── J-4.3.3: 禁止抛裸异常
└── J-4.4: 生成器行为禁用
    ├── J-4.4.1: 遇到缺失信息时禁止脑补，必须停止输出
    ├── J-4.4.2: 禁止反向依赖引用
    ├── J-4.4.3: 禁止迁移/重命名/删除操作（除非README明确列出）
    └── J-4.4.4: 禁止新增公共层
```

------------------------------

## K: 连接器分层架构详细设计

### K-1: 连接器架构哲学

```
connectors目录是系统与外部依赖的统一连接层，通过标准化接口封装外部服务连接，实现依赖的可替换性、可测试性和配置化管理。连接器遵循接口分离原则，为每种外部服务提供专门的连接器实现。
```

------------------------------

### K-2: 数据存储连接器

```
├── K-2.1: mongo_connector.py - MongoDB数据库连接器
│   └── 封装MongoDB连接池管理、事务处理、索引优化和连接监控，提供异步操作接口和自动重连机制
├── K-2.2: redis_connector.py - Redis缓存连接器
│   └── 封装Redis连接池管理、键值操作、TTL管理和集群支持，提供高性能的缓存访问接口
├── K-2.3: chroma_connector.py - ChromaDB向量数据库连接器
│   └── 封装向量数据库连接、向量索引管理、相似度查询和批量操作，支持向量数据的高效检索
└── K-2.4: minio_connector.py - MinIO对象存储连接器
    └── 封装对象存储连接、文件上传下载、存储桶管理和访问权限控制，提供安全的文件存储服务
```

------------------------------

### K-3: 外部服务连接器

```
├── K-3.1: openai_connector.py - OpenAI API连接器
│   └── 封装OpenAI API调用、模型选择、Prompt管理、限流控制和错误重试，提供稳定的AI推理服务接口
└── K-3.2: email_connector.py - 邮件服务连接器
    └── 封装SMTP邮件发送、模板渲染、队列管理和发送状态追踪，提供可靠的邮件通信服务
```

------------------------------

### K-4: 连接器设计规范

```
├── K-4.1: 统一接口规范
│   └── 所有连接器必须实现标准接口：异步连接方法、健康检查方法、优雅关闭方法和配置验证方法
├── K-4.2: 配置驱动设计
│   └── 连接器配置完全外部化，通过.env文件和配置管理器获取连接参数，包括连接字符串、超时设置、重试策略、连接池参数等
├── K-4.3: 故障恢复机制
│   └── 连接器内置故障检测和自动恢复机制，包括连接断开重试、超时处理、限流保护和降级模式
├── K-4.4: launcher.py集成机制
│   └── Launcher通过连接器工厂模式创建连接器实例，将连接器注入到需要的模块中
├── K-4.5: 模块依赖注入
│   └── 业务模块通过构造函数接收连接器实例，避免直接创建外部依赖连接
└── K-4.6: 配置热更新支持
    └── 连接器支持配置的运行时更新，包括连接参数调整、连接池大小变更、超时设置修改等
```

------------------------------

## L: 外部依赖管理与降级机制

### L-1: 硬依赖管理

```
├── L-1.1: MongoDB - 用户画像、对话历史存储
│   ├── L-1.1.1: 连接管理 - 异步连接池，支持自动重连
│   ├── L-1.1.2: 事务支持 - 多文档事务操作
│   └── L-1.1.3: 索引优化 - 查询性能优化
├── L-1.2: Redis - 会话管理、状态缓存
│   ├── L-1.2.1: 连接池管理 - 高并发连接支持
│   ├── L-1.2.2: TTL管理 - 自动过期机制
│   └── L-1.2.3: 集群支持 - Redis集群部署支持
└── L-1.3: OpenAI API - LLM智能分析服务
    ├── L-1.3.1: API调用管理 - 限流控制和重试机制
    ├── L-1.3.2: 模型管理 - 多模型支持和切换
    └── L-1.3.3: Prompt管理 - 提示词模板管理
```

------------------------------

### L-2: 软依赖管理

```
├── L-2.1: MinIO - 文件存储（降级时使用本地存储）
│   ├── L-2.1.1: 对象存储管理 - 文件上传下载和元数据管理
│   ├── L-2.1.2: 存储桶管理 - 多租户存储空间管理
│   ├── L-2.1.3: 访问权限控制 - 细粒度访问控制
│   └── L-2.1.4: 降级策略 - 本地文件系统降级
└── L-2.2: ChromaDB - 向量搜索（降级时使用简单匹配）
    ├── L-2.2.1: 向量索引管理 - 高维向量索引和检索
    ├── L-2.2.2: 相似度查询 - 语义相似度搜索
    ├── L-2.2.3: 批量操作 - 批量向量插入和查询
    └── L-2.2.4: 降级策略 - 关键词匹配降级
```

------------------------------

### L-3: 降级模式设计

```
├── L-3.1: 文件存储降级
│   ├── L-3.1.1: 降级触发 - MinIO不可用时自动启用本地文件系统
│   ├── L-3.1.2: 功能保持 - 基本的文件上传下载功能保持可用
│   ├── L-3.1.3: 性能影响 - 本地存储性能和扩展性限制
│   └── L-3.1.4: 恢复机制 - MinIO恢复后自动切回
├── L-3.2: 搜索降级
│   ├── L-3.2.1: 降级触发 - ChromaDB不可用时启用关键词匹配
│   ├── L-3.2.2: 功能影响 - 语义搜索降级为关键词搜索
│   ├── L-3.2.3: 准确率影响 - 搜索准确率和召回率下降
│   └── L-3.2.4: 恢复机制 - ChromaDB恢复后自动恢复语义搜索
└── L-3.3: 功能降级策略
    ├── L-3.3.1: 核心功能保持 - 确保核心业务流程可用
    ├── L-3.3.2: 状态标记 - 明确标记系统降级状态
    ├── L-3.3.3: 用户提示 - 向用户说明降级模式和功能限制
    └── L-3.3.4: 监控告警 - 降级状态监控和告警机制
```

------------------------------

## M: Agent注册表驱动架构

### M-1: 注册表架构设计

```
├── M-1.1: applications/__registry__.py规范
│   ├── M-1.1.1: 三层架构分类 - core、business、service三个启动层级
│   ├── M-1.1.2: 启动顺序控制 - core → business → service的严格顺序
│   ├── M-1.1.3: 并发控制 - 同层Agent支持并发启动
│   └── M-1.1.4: 依赖关系定义 - Agent间依赖关系声明
├── M-1.2: 注册表结构示例
│   ├── M-1.2.1: core层 - routing_agent、auth_agent、database_agent等核心Agent
│   ├── M-1.2.2: business层 - resume_agent、matching_agent、company_identity_agent等业务Agent
│   └── M-1.2.3: service层 - entry_agent、frontend_service_agent等服务Agent
└── M-1.3: 配置字段规范
    ├── M-1.3.1: name - Agent名称标识
    ├── M-1.3.2: module - Agent模块路径
    ├── M-1.3.3: required - 是否为必需Agent
    └── M-1.3.4: ⚠️ 未定义 - 其他配置字段如dependencies、config等
```

------------------------------

### M-2: 注册表管理优势

```
├── M-2.1: 声明式管理
│   └── 新增/删除Agent只需修改注册表，无需修改启动代码
├── M-2.2: 启停顺序
│   └── 自动按依赖关系管理启动顺序，避免循环依赖
├── M-2.3: 标签分类
│   └── core/business/service分类管理，便于分层启动和管理
└── M-2.4: 可选模块
    └── 支持required=False的可选Agent，失败时不影响系统启动
```

------------------------------

### M-3: Agent装配流程

```
├── M-3.1: 注册表加载
│   └── 从applications/__registry__.py加载Agent配置信息
├── M-3.2: 依赖验证
│   ├── M-3.2.1: 依赖关系检查 - 验证Agent间依赖关系正确性
│   ├── M-3.2.2: 循环依赖检测 - 检测并阻止循环依赖
│   └── M-3.2.3: 配置完整性验证 - 验证每个Agent的配置完整性
├── M-3.3: 分层装配
│   ├── M-3.3.1: 按层级顺序 - 严格按照core → business → service顺序装配
│   ├── M-3.3.2: 同层并发 - 同一层级的Agent可以并发装配
│   └── M-3.3.3: 故障处理 - 必需Agent失败时终止，可选Agent失败时跳过
└── M-3.4: 依赖注入
    ├── M-3.4.1: 连接器注入 - 将相应的连接器实例注入Agent
    ├── M-3.4.2: 配置注入 - 将配置参数注入Agent
    └── M-3.4.3: ⚠️ 未定义 - AgentFactory.create_agent()的具体实现方式
```

------------------------------

## N: 自包含锚点信息

### N-1: 依赖与职责

```
├── N-1.1: 上游触发
│   └── CLI命令行参数解析 → main.py
├── N-1.2: 下游调用
│   ├── N-1.2.1: routing_agent的config_manager服务（配置读取）
│   ├── N-1.2.2: database_agent（数据存储层访问）
│   └── N-1.2.3: applications/__registry__.py（模块注册信息）
├── N-1.3: 数据读写
│   ├── N-1.3.1: 读取 - .env文件、applications/__registry__.py
│   └── N-1.3.2: 写入 - 系统日志、启动状态
└── N-1.4: 并发控制
    └── 同层Agent并发装配，跨层严格顺序装配
```

------------------------------

### N-2: 重大决策

```
├── N-2.1: 启动阶段
│   └── 环境检查(必跑) → 依赖检查(可跳过) → 装配 → 启动 → 就绪
├── N-2.2: 返回码标准
│   └── 0=成功, 1=失败, 2=降级成功
├── N-2.3: 方法长度上限
│   └── 统一≤25行
├── N-2.4: 硬依赖服务
│   └── MongoDB、Redis、OpenAI API
├── N-2.5: 软依赖服务
│   └── MinIO、ChromaDB（可降级）
└── N-2.6: 配置来源优先级
    └── .env文件 > 环境变量 > 默认值
```

------------------------------

### N-3: 契约与字段

```
├── N-3.1: main.py参数字段
│   ├── N-3.1.1: env_check: bool, 默认False, 执行环境检查
│   ├── N-3.1.2: health: bool, 默认False, 执行健康检查
│   ├── N-3.1.3: start: bool, 默认False, 启动系统
│   ├── N-3.1.4: production: bool, 默认False, 生产模式开关
│   └── N-3.1.5: env_file: str, 可选, 指定配置文件路径
├── N-3.2: Launcher类方法契约
│   ├── N-3.2.1: env_check() → int: 环境检查，返回0|1
│   ├── N-3.2.2: deps_check(skip_non_critical: bool = True) → int: 依赖检查，返回0|1|2
│   ├── N-3.2.3: start(production: bool = False, env_file: str = None) → int: 启动系统
│   ├── N-3.2.4: health() → int: 健康检查
│   └── N-3.2.5: shutdown() → int: 优雅关闭
└── N-3.3: 错误码全集
    ├── N-3.3.1: BOOT/ENV_MISSING: 环境变量缺失
    ├── N-3.3.2: BOOT/CONFIG_INVALID: 配置格式错误
    ├── N-3.3.3: BOOT/DEPS_UNAVAILABLE: 硬依赖不可用
    └── N-3.3.4: BOOT/TIMEOUT: 启动超时
```

------------------------------

### N-4: 指标与日志要点

```
├── N-4.1: 必填日志字段
│   └── request_id、module_name、operation、duration_ms、success、retry_count
└── N-4.2: 核心指标
    ├── N-4.2.1: boot_startup_duration_ms - 启动耗时
    ├── N-4.2.2: boot_health_check_success_rate - 健康检查成功率
    └── N-4.2.3: boot_dependency_availability - 依赖可用率
```

------------------------------

### N-5: 示例声明

```
本文档所有示例代码仅用于协议理解，不得据此实现。实际实现必须严格遵守开发边界限制和职责分离原则。
```
