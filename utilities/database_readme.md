# 🗄️ Database Development Timeline Design

## 🏗️ 数据库开发时间线设计规范

> **开发策略**: 按照模块开发进度分阶段实现数据库功能，优先支持已实现的业务模块

### 📅 开发时间线概览

```
阶段1 (当前最优先) → 阶段2 (所有其余扩展)
MBTI模块基础功能      完整系统功能扩展
```

---

# 📍 阶段1：MBTI模块基础功能 (当前最优先)

## 🎯 阶段1目标
支持已实现的MBTI模块完整功能和基础用户认证

## 🏗️ 阶段1核心集合设计

### **user_profiles** (用户画像集合)
**MBTI测试数据存储**
- 最终人格类型（ENFP等16种类型）
- 测试结果数据（原始分数、百分比、各维度详情）
- 反向评估结果（维度分数和最终报告）
- 测试完成时间戳

**核心索引设计**
- `user_id` (唯一索引) - 用户ID唯一索引

### **user_status** (用户状态集合)
**用户认证信息**
- 用户名、邮箱、密码（加密存储）
- 注册时间、最后登录时间

**测试步骤状态叠加**
- mbti_step1：complete/incomplete
- mbti_step2：complete/incomplete
- mbti_step3：complete/incomplete
- mbti_step4：complete/incomplete
- mbti_step5：complete/incomplete
- JobFindingRegistryComplete：true/false

**用户状态管理**
- 用户激活状态：ACTIVE/SUSPENDED/DELISTED
- 双身份激活：求职者身份和雇主身份的独立激活状态

**核心索引设计**
- `user_id` (唯一索引) - 用户ID唯一索引

### **user_chathistory** (用户聊天历史集合)
**对话记录存储**
- 用户ID关联
- 对话会话ID
- 用户回复内容
- 机器生成的问题
- 时间戳记录

**核心索引设计**
- `user_id` (唯一索引) - 用户ID唯一索引

### **user_archive** (用户归档集合)
**历史数据存储**
- 用户历史数据归档
- 已删除用户的备份数据
- 数据迁移和清理的归档记录
- 用户状态变更的历史记录

**核心索引设计**
- `user_id` (唯一索引) - 用户ID唯一索引

## 🔧 阶段1数据操作需求

### **MBTI模块数据库交互**
- **用户状态查询**：检查MBTI测试完成状态和求职注册状态
- **测试结果保存**：存储各步骤的测试数据和最终人格类型
- **步骤状态更新**：标记测试各步骤的完成状态
- **用户认证**：登录、注册、密码验证等基础认证功能

### **必需的数据库操作**
- database_query - 查询用户状态和测试数据
- database_save - 保存MBTI测试结果
- database_auth - 用户认证管理
- database_update - 更新测试步骤状态
- database_chat_save - 保存聊天历史
- database_chat_query - 查询聊天历史

## 📋 阶段1开发实施计划

### **立即需要实现**
```
数据库设计：
✅ user_profiles集合结构设计 (MBTI数据存储)
✅ user_status集合结构设计 (认证+状态叠加)
✅ user_chathistory集合结构设计 (聊天记录)
✅ 索引策略制定

数据库操作：
🔄 database_query实现 (状态查询)
🔄 database_save实现 (MBTI结果保存)
🔄 database_auth实现 (登录注册)
🔄 database_update实现 (步骤状态更新)
🔄 database_chat_save实现 (聊天记录保存)
🔄 database_chat_query实现 (聊天记录查询)

集成测试：
⏳ MBTI模块数据库集成测试
⏳ 用户认证流程测试
⏳ 聊天记录管理测试
```

### **阶段1核心功能映射**
```
MBTI Step1 → database_query(user_status.JobFindingRegistryComplete)
MBTI Step2 → database_save(user_profiles.mbti_results) + database_update(user_status.mbti_step2)
MBTI Step3 → database_save(user_profiles.mbti_results) + database_update(user_status.mbti_step3)
MBTI Step4 → database_save(user_profiles.mbti_results) + database_update(user_status.mbti_step4)
MBTI Step5 → database_save(user_profiles.mbti_results) + database_update(user_status.mbti_step5)
用户登录 → database_auth(login)
用户注册 → database_auth(register)
聊天记录 → database_chat_save(user_chathistory)
```

## 📅 阶段1开发时间估算
```
阶段1 (2-3周):
├── MongoDB集合设计: 2天
├── 数据库操作实现: 5天
├── MBTI模块集成: 3天
├── 用户认证实现: 3天
├── 测试与调试: 2天
```

## 🎯 阶段1核心设计要点总结

### **三大核心集合架构**
1. **user_profiles**：专注用户画像存储，目前主要存储MBTI测试相关数据
2. **user_status**：用户状态集合，整合认证信息和测试完成状态的叠加管理
3. **user_chathistory**：用户聊天历史集合，存储对话记录和交互数据

### **设计理念**
- **职责分离**：每个集合都有明确的存储职责，避免数据耦合
- **状态叠加**：测试步骤状态在user_status中叠加管理，便于查询和更新
- **扩展性**：当前三个集合为未来扩展提供了清晰的基础架构

## 📊 数据库初始化和索引验证

### **初始化脚本**
使用 `init_mongodb_corrected.py` 脚本进行数据库初始化，该脚本将：
- 创建所有必需的集合
- 设置正确的索引结构
- 插入示例数据用于测试

### **索引验证命令**
```bash
# 检查所有集合的索引
docker exec mongodb-dev mongosh careerbot_mongodb --eval "db.user_profiles.getIndexes(); db.user_status.getIndexes(); db.user_chathistory.getIndexes();"

# 验证集合统计
docker exec mongodb-dev mongosh careerbot_mongodb --eval "db.getCollectionNames();"
```

### **索引设计验证清单**
- ✅ `user_profiles.user_id` - 唯一索引
- ✅ `user_status.user_id` - 唯一索引
- ✅ `user_chathistory.user_id` - 唯一索引
- ✅ `user_archive.user_id` - 唯一索引

### **索引策略说明**
1. **简化原则**: 每个集合都只有 `user_id` 作为唯一索引
2. **数据优先**: 其他字段仅作为文档数据存储，无额外索引
3. **性能考虑**: 写入性能优先，查询时可接受全表扫描

---

# 📍 阶段2：完整系统功能扩展 (所有其余扩展)

> **目标**: 实现所有剩余的功能扩展，包括标签系统、公司画像、职位匹配等完整系统功能

### 2.1 扩展用户画像数据维度

#### **扩展个人信息维度**
- **联系信息**：详细地址、紧急联系人、备用联系方式
- **教育背景**：学历信息、毕业院校、专业、成绩、获得的证书和荣誉
- **工作经历**：公司名称、职位、任期、工作地点、工作描述、成就、使用的技术、薪资范围
- **技能列表**：技能名称、熟练程度、使用年限、相关证书、最后使用时间
- **求职意向**：期望职位、期望行业、期望地点、薪资期望、工作类型、是否愿意搬迁、入职时间
- **家庭背景**：婚姻状况、家庭成员、文化背景、母语、使用语言

#### **九型人格测试数据**
- **主导类型**：9种人格类型之一
- **翼型**：辅助人格类型（如3w2）
- **各类型得分**：9个维度的详细得分
- **测试完成时间**：评估完成的时间戳
- **详细分析报告**：基于九型人格的职业建议和领导风格分析

#### **7层标签体系应用**
- **标签ID**：唯一标识符
- **置信度分数**：0-1之间的匹配度
- **标签来源**：MBTI衍生、用户输入、系统分析等
- **应用时间戳**：标签应用的时间

#### **分析报告存储**
- **报告类型**：职业兼容性分析、技能评估等
- **生成时间**：报告创建的时间戳
- **数据来源**：MBTI结果、九型人格测试、技能评估等
- **洞察和建议**：详细的职业匹配分析和推荐职位

### 2.2 用户状态管理扩展

#### **独立状态集合 (user_status)**
- **激活状态**：用户账号的整体激活状态
- **双身份激活**：求职者和雇主身份的独立管理
- **购买计数**：记录用户购买行为，用于状态转换规则
- **暂停和下架机制**：基于购买计数的自动状态管理
- **搜索历史**：雇主查看求职者的历史记录

#### **状态转换规则**
- **购买计数触发**：每2次购买触发3天暂停，每10次购买触发下架
- **原子操作保障**：使用MongoDB原子操作确保计数准确性
- **状态恢复机制**：暂停到期自动恢复，下架需要手动重新激活

### 2.3 标签层次结构设计

#### **标签层级体系**
- **Layer 0**：根层 - 基础分类（如技术、商业、艺术等）
- **Layer 1**：大类 - 主要领域（如编程、设计、市场等）
- **Layer 2**：中类 - 专业方向（如Web开发、移动开发、UI设计、数字营销等）
- **Layer 3**：小类 - 具体技能（如Python、JavaScript、Photoshop等）
- **Layer 4**：子类 - 细分能力和框架（如Django、Spring Boot、Vue.js等）
- **Layer 5**：实例 - 实际应用场景（如电商网站开发、金融系统开发等）
- **Layer 6**：变体 - 特殊情况和变体（如区块链开发、物联网应用等）

#### **标签权重分级**
- **REQUIRED**：必备标签（最高权重）
- **PREFERRED**：偏好标签（中等权重）
- **CONTEXTUAL**：上下文标签（辅助权重）

### 2.4 公司画像数据维度

#### **公司注册信息**
- **注册类型**：SEC/DTI注册类型
- **注册编号**：SEC注册号或DTI营业执照号
- **注册日期和到期日**
- **公司名称和商标**
- **注册地址和经营地址**

#### **公司基本信息**
- **行业分类**：所属行业和子行业
- **公司规模**：员工数量、公司类型（创业公司、小型、中型、大型、巨头）
- **成立年份**
- **公司网站和社交媒体**
- **公司简介、使命、愿景和核心价值观**

#### **财务信息（可选）**
- **年收入范围**
- **融资状态和投资者信息**
- **上市信息（如果适用）**

#### **公司文化和工作环境**
- **工作文化描述**
- **福利待遇**
- **工作生活平衡评分**
- **多元化包容性评分**
- **远程办公政策**
- **专业发展机会**

#### **管理层信息**
- **高管背景和教育**
- **LinkedIn资料**
- **任期年限**

#### **部门结构**
- **各部门信息**
- **各部门职责**
- **各部门所需技能**

### 2.5 职位发布数据维度

#### **职位基本信息**
- **职位ID和标题**
- **所属部门**
- **雇佣类型**（全职、兼职、合同工）

#### **职位详细描述**
- **职位概述**
- **职责列表**
- **要求列表**

#### **薪资和福利**
- **薪资范围**
- **福利待遇**
- **额外补偿**

#### **工作条件**
- **工作地点**
- **工作时间安排**
- **远程工作选项**
- **出差要求**
- **汇报对象**

#### **技能要求**
- **必需技能列表**
- **技能等级要求**
- **是否为必备技能**

#### **招聘流程**
- **申请截止日期**
- **面试阶段**
- **期望入职日期**
- **职位状态**

#### **招聘统计**
- **申请数量统计**
- **入职率**
- **平均招聘周期**

#### **招聘负责人信息**
- **招聘人员联系方式**

### 2.6 文档验证系统

#### **必要文件验证**
- **营业执照验证**
- **SEC注册文件**
- **税务清关证明**
- **GIS证书**
- **市长许可**

### 2.7 公司声誉数据

#### **外部评价**
- **Glassdoor评分**
- **员工评价数量**
- **雇主品牌描述**

#### **奖项和认可**
- **获得的奖项**
- **社区参与活动**

### 2.8 嵌套职位发布结构

#### **职位嵌套设计**
- **职位信息完全嵌套在公司文档中**
- **每个公司文档包含多个职位数组**
- **职位标签与公司标签的关联**
- **职位发布日期和管理**

## 📅 阶段2开发时间估算

```
阶段2 (8-12周):
├── 标签系统设计与实现: 3周
├── 九型人格测试集成: 1周
├── 公司画像系统: 2周
├── 职位匹配引擎: 3周
├── 完整系统集成测试: 2周
```

## 📋 阶段2实现优先级

### **阶段2：完整系统功能扩展 (计划中)**
- [ ] 扩展user_profiles字段 (教育、工作、技能等)
- [ ] 九型人格测试集成
- [ ] 7层标签体系设计与实现
- [ ] 标签匹配算法
- [ ] company_profiles嵌套jobposts实现
- [ ] 公司画像系统
- [ ] 职位匹配引擎
- [ ] 智能推荐系统
- [ ] 文档验证系统
- [ ] 公司声誉数据管理

---

*此文档按照时间线进行组织，阶段1聚焦当前最优先的MBTI模块基础功能，阶段2包含所有其余扩展功能，为后续开发提供清晰的实施路径。*
